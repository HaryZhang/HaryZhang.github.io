Array.prototype.indexOf=function(item){for(var i=0;i<this.length;i++){if(this[i]==item)return i}return-1};Array.prototype.delete=function(item){var i=this.indexOf(item);i>-1&&this.splice(i,1)};function getAngle(point,point2){var X=point2.x-point.x;var Y=point2.y-point.y;var angle=Math.acos(Y/Math.sqrt(X*X+Y*Y));if(X>=0&&Y>=0){angle=2*Math.PI-angle}else{if(X>=0&&Y<=0){angle=2*Math.PI-angle}}return angle}function drawDashLine(lineCon,x1,y1,x2,y2,offset){offset=undefined===offset?5:offset;var bevelLen=Math.sqrt(Math.pow(x2-x1,2)+Math.pow(y2-y1,2));var num=Math.floor(bevelLen/offset);for(var i=0;i<num;i++){var X=x1+(x2-x1)/num*i;var Y=y1+(y2-y1)/num*i;if(i%2==0){lineCon["moveTo"](X,Y)}else{lineCon["lineTo"](X,Y)}}}!function($){var PATH="images/";var winHeight=window.innerHeight,winWidth=750;var Container=PIXI.Container;var mainContainer=new Container;mainContainer.width=winWidth;mainContainer.height=winHeight;var tvContainer=new Container;tvContainer.width=180;tvContainer.height=180;tvContainer.position.set(200,150);var selectedContainer=new Container;var roomContainer=new Container;var flagContainer=new Container;var shareContainer=new Container;var secondContainer=new Container;var thirdContainer=new Container;var unselectedContainer=new Container;var PeoplesArr=[];var CanvasRenderer=new PIXI.CanvasRenderer(winWidth,winHeight,{backgroundColor:16777215});var shareTexture=(PIXI.loader.resources,PIXI.utils.TextureCache,PIXI.Texture,PIXI.Text);var shareTexts=["球可以看，发型不可以乱","看球的时候请放下手机","看球也是体育运动","恋爱是看球事业的绊脚石","我拿你当朋友才约你看球","足球与工作，不可兼得","看球其实不重要，重要的其实是吃什么","世界杯是把杀猪刀","别人家的主队，从来都没让我失望过","可以不刷短视频APP了","我常常因为看球，而显得和你们格格不入","猜得再准，也敌不过爆冷","真球迷专属认证","看球是不可能看球的，这辈子都不可能看球的","成年人的世界没有杯"];var roomsImg=[PATH+"rooms/room1.png",PATH+"rooms/room2.png",PATH+"rooms/room3.png",PATH+"rooms/room4.png",PATH+"rooms/room5.png",PATH+"rooms/room6.png",PATH+"rooms/room7.png"];var tvImg=[PATH+"surprised.png",PATH+"surprised2.png",PATH+"slide.png"];var othersImg=[PATH+"others/1.png",PATH+"others/2.png",PATH+"others/3.png",PATH+"others/4.png",PATH+"others/5.png",PATH+"others/6.png",PATH+"others/7.png",PATH+"others/8.png",PATH+"others/9.png",PATH+"others/10.png",PATH+"others/11.png",PATH+"others/12.png",PATH+"others/13.png",PATH+"others/14.png",PATH+"others/15.png",PATH+"others/16.png",PATH+"others/17.png",PATH+"others/18.png",PATH+"others/19.png",PATH+"others/20.png",PATH+"others/21.png",PATH+"others/22.png",PATH+"others/23.png",PATH+"others/24.png",PATH+"others/25.png",PATH+"others/26.png",PATH+"others/27.png",PATH+"others/28.png",PATH+"others/29.png",PATH+"others/30.png"];var flagsImg=[PATH+"flags/flag1.png",PATH+"flags/flag2.png",PATH+"flags/flag3.png",PATH+"flags/flag4.png",PATH+"flags/flag5.png",PATH+"flags/flag6.png",PATH+"flags/flag7.png",PATH+"flags/flag8.png",PATH+"flags/flag9.png",PATH+"flags/flag10.png"];var userAgent=window.navigator.userAgent.toLowerCase();var isIphoneX=/iphone/gi.test(userAgent)&&812==screen.height&&375==screen.width;if(isIphoneX){$(".guide_img").css({top:"294px"})}var manClothsAll=[manCloths,manLeftCloths,manRightCloths,manBackCloths];var manFaceAll=[manFace,manLeftFace,manRightFace,manBackFace];var manHairAll=[manHair,manLeftHair,manRightHair,manBackHair];var womanClothsAll=[womanCloths,womanLeftCloths,womanRightCloths,womanBackCloths];var womanFaceAll=[womanFace,womanLeftFace,womanRightFace,womanBackFace];var womanHairAll=[womanHair,womanLeftHair,womanRightHair,womanBackHair];$("#main_container").append(CanvasRenderer.view);$(".welcome_layer, .guide").bind("touchmove",function(event){event.preventDefault()});PIXI.loader.add([PATH+"rotate.png",PATH+"close.png",roomsImg[0],flagsImg[0],tvImg[0],tvImg[1],tvImg[2],PATH+"share_slogan.png",PATH+"man_left/body.png",PATH+"man_right/body.png",PATH+"woman_left/body.png",PATH+"woman_right/body.png"]).load(initLoaded);function initLoaded(){winWidth=window.innerWidth;$(".world_cup_layer, .main_layer").width(750).height(winHeight);mainContainer.width=winWidth;mainContainer.interactive=true;mainContainer.on("touchend",function(){for(var i=0;i<selectedContainer.children.length;i++){var activeItem=selectedContainer.children[i];new TWEEN.Tween(activeItem.scale).to({x:1,y:1},100).start();if(0===activeItem.sex||1===activeItem.sex){for(var n=0;n<activeItem.children.length;n++){var item=activeItem.children[n];if(item.children[0]&&"bone1"==item.children[0].name){item.children[0].children[1].dragging=false}else{n==activeItem.children.length-1?item.children[1].dragging=false:item.dragging=false}}}else{for(var n=0;n<activeItem.children.length;n++){activeItem.children[0].dragging=false;activeItem.children[1].children[1].dragging=false}}}});initRoomAndFlag();var bottomCon=new PIXI.Graphics;bottomCon.beginFill(16777215);bottomCon.drawRect(0,winHeight-156,750,156);bottomCon.endFill();shareContainer.position.set(0,0);var whiteBg=new PIXI.Graphics;whiteBg.beginFill(16777215);whiteBg.drawRect(0,0,2e3,2e3);whiteBg.endFill();var erweima=PIXI.Sprite.fromImage([PATH+"erweima.png"]);erweima.width=108,erweima.height=108,erweima.position.set(618,winHeight-132);var bottom_slogan=new PIXI.Sprite(PIXI.loader.resources[PATH+"share_slogan.png"].texture);bottom_slogan.position.set(40,winHeight-150);var sharetext=shareTexts[Math.floor(Math.random()*shareTexts.length)];var shareSlogan=new shareTexture(sharetext,{fontSize:"20px",fill:"#000000"});shareSlogan.position.set(40,winHeight-50);shareContainer.visible=false;shareContainer.addChild(bottomCon,bottom_slogan,shareSlogan,erweima);var mask=new PIXI.Graphics;mask.beginFill(10053375);mask.drawRect(0,0,750,1448);mask.endFill();thirdContainer.mask=mask;thirdContainer.addChild(mask,whiteBg,roomContainer,flagContainer,tvContainer,unselectedContainer,selectedContainer);secondContainer.addChild(thirdContainer,shareContainer);mainContainer.addChild(secondContainer);CanvasRenderer.render(mainContainer);render()}function initRoomAndFlag(){var tvimg1=new PIXI.Sprite(PIXI.loader.resources[tvImg[0]].texture);tvimg1.visible=false;var tvimg2=new PIXI.Sprite(PIXI.loader.resources[tvImg[1]].texture);tvimg2.visible=false;tvimg2.x=80;tvimg2.y=50;var slideimg=PIXI.Sprite.fromImage([tvImg[2]]);slideimg.visible=false;slideimg.y=30;tvContainer.addChild(slideimg);tvContainer.addChild(tvimg1);tvContainer.addChild(tvimg2);var room=new PIXI.Sprite(PIXI.loader.resources[roomsImg[0]].texture);var flag=new PIXI.Sprite(PIXI.loader.resources[flagsImg[0]].texture);flagContainer.position.set(630,40);roomContainer.index=0;flagContainer.index=0;roomContainer.addChild(room);flagContainer.addChild(flag);roomContainer.interactive=true;roomContainer.buttonMode=true;flagContainer.interactive=true;flagContainer.buttonMode=true;roomContainer.on("tap",function(){if(selectedContainer.children.length){for(var i=0;i<selectedContainer.children.length;i++){var curr=selectedContainer.children[i];curr.chosen=false;curr.outline.visible=false;unselectedContainer.addChild(curr);selectedContainer.removeChild(curr)}}});flagContainer.on("tap",function(){if(selectedContainer.children.length){for(var i=0;i<selectedContainer.children.length;i++){var curr=selectedContainer.children[i];curr.chosen=false;curr.outline.visible=false;unselectedContainer.addChild(curr);selectedContainer.removeChild(curr)}}})}function render(){TWEEN.update();requestAnimationFrame(render);CanvasRenderer.render(mainContainer)}function showCryFace(){$("#float-cry").fadeIn();setTimeout(function(){$("#float-cry").fadeOut()},1e3)}var tween,imgInterval;function changeTVShow(){if(tween){tween.stop();tween=null}if(imgInterval!=null){clearInterval(imgInterval);imgInterval=null}var slideImg=tvContainer.getChildAt(0);slideImg.visible=true;var x=slideImg.x;var y=slideImg.y;var flag=true;imgInterval=setInterval(function(){if(flag){tvContainer.getChildAt(1).visible=true;tvContainer.getChildAt(2).visible=false}else{tvContainer.getChildAt(1).visible=false;tvContainer.getChildAt(2).visible=true}flag=!flag},200);tween=new TWEEN.Tween({px:x,py:y}).to({px:x+250,py:y},1500).onStart(function(){}).onUpdate(function(){slideImg.x=this.px;slideImg.y=this.py}).onStop(function(){slideImg.x=x;slideImg.y=y;slideImg.visible=false;clearInterval(imgInterval);tvContainer.getChildAt(1).visible=false;tvContainer.getChildAt(2).visible=false}).onComplete(function(){slideImg.x=x;slideImg.y=y;slideImg.visible=false;clearInterval(imgInterval);tvContainer.getChildAt(1).visible=false;tvContainer.getChildAt(2).visible=false}).start()}function createNewPeople(index){var singlePeople=new Container;PeoplesArr.push(singlePeople);singlePeople.chosen=true;singlePeople.interactive=true;singlePeople.buttonMode=true;singlePeople.on("touchstart",function(){new TWEEN.Tween(this.scale).to({x:1.015,y:1.015},100).start();if(!this.chosen){this.chosen=true;this.outline.visible=true;if(selectedContainer.children.length){var n=selectedContainer.children[0];n.chosen=false;n.outline.visible=false;unselectedContainer.addChild(n);selectedContainer.removeChildren()}PeoplesArr.delete(this);PeoplesArr.push(this);changeMenuStatus(this.sex,singlePeople);selectedContainer.addChild(this);unselectedContainer.removeChild(this)}}).on("touchend",function(){new TWEEN.Tween(this.scale).to({x:1,y:1},100).start()});var curdata;index==0?curdata=z[0]:curdata=Z[0];singlePeople.data=JSON.parse(JSON.stringify(curdata));var randomx=50*Math.random()-50,randomy=50*Math.random()-50;singlePeople.globalPosition={x:singlePeople.data.globalPosition.x+randomx,y:singlePeople.data.globalPosition.y+randomy};singlePeople.sex=index;singlePeople.facingTo=0;singlePeople.faceIndex=0;singlePeople.hairIndex=0;singlePeople.clothIndex=0;if(index==0){createBones(singlePeople,{face:manFaceAll[singlePeople.facingTo][singlePeople.faceIndex],hair:manHairAll[singlePeople.facingTo][singlePeople.hairIndex]});reDrawPeople(singlePeople,manClothsAll[0][0]);setTimeout(function(){initRotate(singlePeople)},100)}else{createBones(singlePeople,{face:womanFaceAll[singlePeople.facingTo][singlePeople.faceIndex],hair:womanHairAll[singlePeople.facingTo][singlePeople.hairIndex]});reDrawPeople(singlePeople,womanClothsAll[0][0]);setTimeout(function(){initRotate(singlePeople)},100)}changeMenuBySex(index,singlePeople);return singlePeople}function changeMenuBySex(sex,currPerson){if(sex==0){$(".man_cloth").show();$(".woman_cloth").hide();$(".man_facingTo").show();$(".woman_facingTo").hide();$(".man_hair").show();$(".woman_hair").hide();$(".man_face").show();$(".woman_face").hide();$(".man_cloth li").removeClass("active");$(".man_cloth li").eq(currPerson.clothIndex).addClass("active");$(".man_facingTo li").removeClass("active");$(".man_facingTo li").eq(currPerson.facingTo).addClass("active");$(".man_face li").removeClass("active");$(".man_face li").eq(currPerson.faceIndex).addClass("active");$(".man_hair li").removeClass("active");$(".man_hair li").eq(currPerson.hairIndex).addClass("active");itemAnimate(currPerson);currPerson.currentSelectIndex=1}else if(sex==1){$(".man_cloth").hide();$(".woman_cloth").show();$(".man_facingTo").hide();$(".woman_facingTo").show();$(".man_hair").hide();$(".woman_hair").show();$(".woman_face").show();$(".man_face").hide();$(".woman_cloth li").removeClass("active");$(".woman_cloth li").eq(currPerson.clothIndex).addClass("active");$(".woman_facingTo li").removeClass("active");$(".woman_facingTo li").eq(currPerson.facingTo).addClass("active");$(".woman_face li").removeClass("active");$(".woman_face li").eq(currPerson.faceIndex).addClass("active");$(".woman_hair li").removeClass("active");$(".woman_hair li").eq(currPerson.hairIndex).addClass("active");itemAnimate(currPerson);currPerson.currentSelectIndex=1}}function changeMenuStatus(sex,currPerson){if(sex==0){$(".man_cloth").show();$(".woman_cloth").hide();$(".man_facingTo").show();$(".woman_facingTo").hide();$(".woman_face").hide();$(".man_face").show();$(".man_hair").show();$(".woman_hair").hide();$(".man_cloth li").removeClass("active");$(".man_cloth li").eq(currPerson.clothIndex).addClass("active");$(".man_facingTo li").removeClass("active");$(".man_facingTo li").eq(currPerson.facingTo).addClass("active");$(".man_face li").removeClass("active");$(".man_face li").eq(currPerson.faceIndex).addClass("active");$(".man_hair li").removeClass("active");$(".man_hair li").eq(currPerson.hairIndex).addClass("active");itemAnimate(currPerson);$(".selected").removeClass("selected");$(".category_item").hide();$(".category_item").eq(currPerson.currentSelectIndex).show();$(".scroll_bar ul li").eq(currPerson.currentSelectIndex).addClass("selected")}else if(sex==1){$(".man_cloth").hide();$(".woman_cloth").show();$(".man_facingTo").hide();$(".woman_facingTo").show();$(".man_hair").hide();$(".woman_hair").show();$(".man_face").hide();$(".woman_face").show();$(".woman_cloth li").removeClass("active");$(".woman_cloth li").eq(currPerson.clothIndex).addClass("active");$(".woman_facingTo li").removeClass("active");$(".woman_facingTo li").eq(currPerson.facingTo).addClass("active");$(".woman_face li").removeClass("active");$(".woman_face li").eq(currPerson.faceIndex).addClass("active");$(".woman_hair li").removeClass("active");$(".woman_hair li").eq(currPerson.hairIndex).addClass("active");itemAnimate(currPerson);$(".selected").removeClass("selected");$(".category_item").hide();$(".category_item").eq(currPerson.currentSelectIndex).show();$(".scroll_bar ul li").eq(currPerson.currentSelectIndex).addClass("selected")}else if(sex==-100){$(".man_cloth").hide();$(".woman_cloth").hide();$(".man_facingTo").hide();$(".woman_facingTo").hide();$(".man_hair").hide();$(".woman_hair").hide();$(".man_face").hide();$(".woman_face").hide();$(".category_guide").show()}}function changeFacingTo(currPerson,index){if(currPerson.facingTo==index){return}currPerson.facingTo=index;if(currPerson.sex==0){currPerson.removeChildren();currPerson.data=JSON.parse(JSON.stringify(z[index]));createBones(currPerson,{face:manFaceAll[index][currPerson.faceIndex],hair:manHairAll[index][currPerson.hairIndex]});reDrawPeople(currPerson,manClothsAll[index][currPerson.clothIndex]);setTimeout(function(){initRotate(currPerson)},100)}else if(1==currPerson.sex){currPerson.removeChildren();currPerson.data=JSON.parse(JSON.stringify(Z[index]));createBones(currPerson,{face:womanFaceAll[index][currPerson.faceIndex],hair:womanHairAll[index][currPerson.hairIndex]});reDrawPeople(currPerson,womanClothsAll[index][currPerson.clothIndex]);setTimeout(function(){initRotate(currPerson)},100)}}function itemAnimate(currPerson){if(currPerson){currPerson.clothIndex&&currPerson.clothIndex>2?$(".cloth").animate({scrollLeft:130*(currPerson.clothIndex-2)+"px"},300):$(".cloth").animate({scrollLeft:"0px"},300);currPerson.facingTo&&currPerson.facingTo>2?$(".facingTo").animate({scrollLeft:130*(currPerson.facingTo-2)+"px"},300):$(".facingTo").animate({scrollLeft:"0px"},300);currPerson.faceIndex&&currPerson.faceIndex>2?$(".face").animate({scrollLeft:130*(currPerson.faceIndex-2)+"px"},300):$(".face").animate({scrollLeft:"0px"},300);currPerson.hairIndex&&currPerson.hairIndex>2?$(".hair").animate({scrollLeft:130*(currPerson.hairIndex-2)+"px"},300):$(".hair").animate({scrollLeft:"0px"},300)}}function changeFace(currPerson,curIndex){if(currPerson.face&&currPerson.faceIndex!=curIndex&&currPerson.facingTo!=3){currPerson.faceIndex=curIndex;if(0==currPerson.sex){currPerson.head.removeChildAt(1);var n=PIXI.Sprite.fromImage(manFaceAll[currPerson.facingTo][curIndex].url);n.position.set(manFaceAll[currPerson.facingTo][curIndex].position.x,manFaceAll[currPerson.facingTo][curIndex].position.y);currPerson.head.addChildAt(n,1);currPerson.face=n}if(1==currPerson.sex){currPerson.head.removeChildAt(1);var n=PIXI.Sprite.fromImage(womanFaceAll[currPerson.facingTo][curIndex].url);n.position.set(womanFaceAll[currPerson.facingTo][curIndex].position.x,womanFaceAll[currPerson.facingTo][curIndex].position.y);currPerson.head.addChildAt(n,1);currPerson.face=n}}}function changeHair(currPerson,curIndex){if(currPerson.hairIndex!=curIndex){currPerson.hairIndex=curIndex;var n=currPerson.hair.visible;if(0==currPerson.sex){currPerson.head.removeChildAt(currPerson.head.children.length-1);var i=PIXI.Sprite.fromImage(manHairAll[currPerson.facingTo][curIndex].url);i.position.set(manHairAll[currPerson.facingTo][curIndex].position.x,manHairAll[currPerson.facingTo][curIndex].position.y);currPerson.head.addChild(i);currPerson.hair=i}if(1==currPerson.sex){currPerson.head.removeChildAt(currPerson.head.children.length-1);var i=PIXI.Sprite.fromImage(womanHairAll[currPerson.facingTo][curIndex].url);i.position.set(womanHairAll[currPerson.facingTo][curIndex].position.x,womanHairAll[currPerson.facingTo][curIndex].position.y);currPerson.head.addChild(i);currPerson.hair=i}currPerson.hair.visible=n}}function changeRooms(index){if(roomContainer.index!=index){roomContainer.removeChildren();roomContainer.index=index;var room=PIXI.Sprite.fromImage([roomsImg[index]]);roomContainer.addChild(room)}}function changeFlag(index){changeTVShow();showCryFace();if(flagContainer.index!=index){flagContainer.removeChildren();flagContainer.index=index;var flag=PIXI.Sprite.fromImage([flagsImg[index]]);flagContainer.addChild(flag)}}function addOthers(i){if(selectedContainer.children.length){var cur=selectedContainer.children[0];cur.chosen=false;cur.outline.visible=false;unselectedContainer.addChild(cur);selectedContainer.removeChildren()}var cont=new Container;cont.chosen=true;cont.interactive=true;cont.buttonMode=true;cont.on("touchstart",function(){new TWEEN.Tween(this.scale).to({x:1.015,y:1.015},100).start();if(!this.chosen){this.chosen=true;this.outline.visible=true;if(selectedContainer.children.length){var curr=selectedContainer.children[0];curr.chosen=false;curr.outline.visible=false;unselectedContainer.addChild(curr);selectedContainer.removeChildren()}selectedContainer.addChild(this);unselectedContainer.removeChild(this)}});cont.data={};var x=50*Math.random()-50;var y=50*Math.random()-50;cont.globalPosition={x:200+x,y:500+y};cont.position.set(cont.globalPosition.x,cont.globalPosition.y);var spr=PIXI.Sprite.fromImage(othersImg[i]);spr.interactive=true;spr.buttonMode=true;var line=new Container;cont.addChild(spr,line);cont.outline=line;spr.texture.baseTexture.hasLoaded?initOthersImg(cont):spr.texture.baseTexture.on("loaded",function(){initOthersImg(cont)});selectedContainer.addChild(cont)}function initOthersImg(othersCon){othersCon.outline.removeChildren();var line=new PIXI.Graphics;line.lineStyle(1,16777215,1);var width=othersCon.width,height=othersCon.height;othersCon.pivot.set(width/2,height/2);othersCon.position.set(othersCon.globalPosition.x+width/2,othersCon.globalPosition.y+height/2);var offset=20;line.moveTo(-offset,-offset);drawDashLine(line,-offset,-offset,width+offset,-offset);drawDashLine(line,width+offset,-offset,width+offset,height+offset);drawDashLine(line,width+offset,height+offset,-offset,height+offset);drawDashLine(line,-offset,height+offset,-offset,-offset);othersCon.outline.addChild(line);othersCon.children[0].on("touchstart",function(e){this.dragging=true;this.startPosition={x:e.data.global.x,y:e.data.global.y}}).on("touchmove",function(e){if(this.dragging){this.newPosition={x:e.data.global.x,y:e.data.global.y};var parentX=this.newPosition.x-this.startPosition.x+this.parent.globalPosition.x+this.parent.pivot._x;var parentY=this.newPosition.y-this.startPosition.y+this.parent.globalPosition.y+this.parent.pivot._y;this.parent.position.set(parentX,parentY)}}).on("touchend",function(){this.dragging=false;this.parent.globalPosition.x=this.parent.position.x-this.parent.pivot._x;this.parent.globalPosition.y=this.parent.position.y-this.parent.pivot._y});var rotateIcon=new PIXI.Sprite(PIXI.loader.resources[PATH+"rotate.png"].texture);rotateIcon.position.set(-offset-43,-offset-38);rotateIcon.interactive=true;rotateIcon.buttonMode=true;rotateIcon.on("touchstart",function(e){this.dragging=true;var globalXY=e.data.global;this.parent.parent.data.rotation=this.parent.parent.rotation;var angle=getAngle({x:this.parent.parent.position.x,y:this.parent.parent.position.y},globalXY);this.startRotation=angle}).on("touchmove",function(e){if(this.dragging){var globalXY=e.data.global,angle=getAngle({x:this.parent.parent.position.x,y:this.parent.parent.position.y},globalXY);this.parent.parent.rotation=angle-this.startRotation+this.parent.parent.data.rotation}}).on("touchend",function(){this.dragging=false});var closeIcon=new PIXI.Sprite(PIXI.loader.resources[PATH+"close.png"].texture);closeIcon.position.set(width+offset,-offset-38);closeIcon.interactive=true;closeIcon.buttonMode=true;closeIcon.on("tap",function(){this.parent.parent.parent.removeChild(this.parent.parent)});othersCon.outline.addChild(rotateIcon,closeIcon)}function reDrawPeople(o,t){var n=o.body,i=PIXI.Sprite.fromImage(t.clothUrl);i.position.set(t.clothPosition.x,t.clothPosition.y);if(t.hatUrl){o.hair.visible=false;var e=PIXI.Sprite.fromImage(t.hatUrl);e.position.set(t.hatPosition.x,t.hatPosition.y);o.head.addChildAt(e,2)}for(var a=(o.boneData,0);a<4;a++){var l=o.boneData[a];if(t.part[a][0]){var h=PIXI.Sprite.fromImage(t.part[a][0]);h.interactive=true;h.buttonMode=true;h.on("touchstart",function(o){computeRotate.call(this.parent.children[1],o)}).on("touchmove",function(o){rotateFunc.call(this.parent.children[1],o)});h.position.set(t.bones[a].bone1.position.x,t.bones[a].bone1.position.y);h.name="addEdCloth";l.children[0].addChild(h)}if(t.part[a][1]){var p=PIXI.Sprite.fromImage(t.part[a][1]);p.position.set(t.bones[a].bone2.position.x,t.bones[a].bone2.position.y);p.name="addEdCloth";l.children[0].children[1].addChild(p)}}n.addChildAt(i,1)}function changeCloth(currPerson){if(currPerson.body.children.length>1){currPerson.hair.visible=true;if(currPerson.head.children.length==4){currPerson.head.removeChildAt(2)}else{3==currPerson.facingTo&&3==currPerson.head.children.length&&currPerson.head.removeChildAt(2)}var t=currPerson.body;t.removeChildAt(t.children.length-1);for(var n=0;n<4;n++){var i=currPerson.boneData[n];if("addEdCloth"==i.children[0].children[i.children[0].children.length-1].name){i.children[0].removeChildAt(i.children[0].children.length-1)}if("addEdCloth"==i.children[0].children[1].children[i.children[0].children[1].children.length-1].name){i.children[0].children[1].removeChildAt(i.children[0].children[1].children.length-1)}}}}function createBones(people,t){var bones=people.data.bones;var bodyCon=new Container;var headCon=new Container;bodyCon.position.set(people.data.bodyPosition.x,people.data.bodyPosition.y);headCon.position.set(people.data.bodyPosition.x+people.data.headPosition.x,people.data.bodyPosition.y+people.data.headPosition.y);var l=PIXI.Sprite.fromImage(people.data.bodyUrl);l.position.set(people.data.bodyImgPosition.x,people.data.bodyImgPosition.y);bodyCon.addChild(l);var p=PIXI.Sprite.fromImage(people.data.headUrl);headCon.addChild(p);if(t.face&&t.face.url){var s=PIXI.Sprite.fromImage(t.face.url);s.position.set(t.face.position.x,t.face.position.y);people.face=s;headCon.addChild(s)}var r=PIXI.Sprite.fromImage(t.hair.url);r.position.set(t.hair.position.x,t.hair.position.y);people.hair=r;headCon.addChild(r);bodyCon.interactive=true;bodyCon.buttonMode=true;bodyCon.on("touchstart",function(e){this.dragging=true;this.startPosition={x:e.data.global.x,y:e.data.global.y}}).on("touchmove",function(e){if(this.dragging){this.newPosition={x:e.data.global.x,y:e.data.global.y};var parentX=this.newPosition.x-this.startPosition.x+this.parent.globalPosition.x+this.parent.pivot._x;var parentY=this.newPosition.y-this.startPosition.y+this.parent.globalPosition.y+this.parent.pivot._y;this.parent.position.set(parentX,parentY)}}).on("touchend",function(){this.dragging=false;this.parent.globalPosition.x=this.parent.position.x-this.parent.pivot._x;this.parent.globalPosition.y=this.parent.position.y-this.parent.pivot._y});headCon.interactive=true;headCon.buttonMode=true;headCon.on("touchstart",function(e){this.dragging=true;this.startPosition={x:e.data.global.x,y:e.data.global.y}}).on("touchmove",function(e){if(this.dragging){this.newPosition={x:e.data.global.x,y:e.data.global.y};var x=this.newPosition.x-this.startPosition.x+this.parent.globalPosition.x+this.parent.pivot._x;var y=this.newPosition.y-this.startPosition.y+this.parent.globalPosition.y+this.parent.pivot._y;this.parent.position.set(x,y)}}).on("touchend",function(){this.dragging=false;this.parent.globalPosition.x=this.parent.position.x-this.parent.pivot._x;this.parent.globalPosition.y=this.parent.position.y-this.parent.pivot._y});people.head=headCon;people.body=bodyCon;var g=new Container;g.name="hand";var c=new Container;c.name="hand";var _=new Container;_.name="leg";var m=new Container;m.name="leg";var b=new Container,d=[g,c,_,m];people.boneData=d;for(var f=0;f<bones.length;f++){var w=d[f],v=bones[f],u=v.bone1,P=v.bone2;w.position.set(u.position.x+u.pivot.x,u.position.y+u.pivot.y);w.pivot.set(u.pivot.x,u.pivot.y);if(bones[f].boneRotate){w.rotation=bones[f].boneRotate}var k=new Container;k.name="bone1";k.position.set(u.pivot.x,u.pivot.y);k.pivot.set(u.pivot.x,u.pivot.y);k.rotation=bones[f].bone1.rotation;var C=PIXI.Sprite.fromImage(people.data.part[f][0]);k.addChild(C);C.interactive=true;C.buttonMode=true;C.on("touchstart",function(e){computeRotate.call(this.parent.children[1],e)}).on("touchmove",function(e){rotateFunc.call(this.parent.children[1],e)});var I=new PIXI.Graphics;I.beginFill(65535);I.drawCircle(0,0,2);I.endFill();I.position.set(u.position.x+u.pivot.x,u.position.y+u.pivot.y);var U=new PIXI.Graphics;U.beginFill(65535);U.drawCircle(0,0,2);U.endFill();U.position.set(P.position.x+P.pivot.x,P.position.y+P.pivot.y);b.addChild(I);var T=new Container;T.name="bone2";var S=PIXI.Sprite.fromImage(people.data.part[f][1]),Graphics=new PIXI.Graphics;Graphics.position.set(v.end.position.x,v.end.position.y);T.addChild(S,Graphics);T.data=bones[f].bone2;T.rotation=bones[f].bone2.rotation;T.startRotation=0;T.pivot.set(P.pivot.x,P.pivot.y);T.position.set(P.position.x+P.pivot.x,P.position.y+P.pivot.y);T.interactive=true;T.buttonMode=true;T.on("touchstart",computeRotate).on("touchmove",rotateFunc);k.addChild(T);w.addChild(k,U)}if(people.facingTo===0){people.addChild(_,m,bodyCon,g,c,b,headCon)}else if(people.facingTo===3){people.addChild(_,m,g,c,bodyCon,b,headCon)}else if(2==people.facingTo){people.addChild(g,_,m,bodyCon,c,b,headCon)}else if(1==people.facingTo){people.addChild(c,_,m,bodyCon,g,b,headCon)}var j=new Container;people.outline=j;people.addChild(j);if(1==people.facingTo){people.pivot.set(0,people.height/2);people.position.set(people.globalPosition.x+people.width/2,people.globalPosition.y+people.height/2);0==people.sex?people.globalPosition.x+=150:people.globalPosition.x+=130;people.outline.position.set(-people.width/2,0)}else{if(0==people.pivot._x){0==people.sex?people.globalPosition.x-=150:1==people.sex&&(people.globalPosition.x-=130)}people.pivot.set(people.width/2,people.height/2);people.position.set(people.globalPosition.x+people.width/2,people.globalPosition.y+people.height/2)}}function getDistance(point,point2){var dis=Math.sqrt(Math.pow(point2.x-point.x,2)+Math.pow(point2.y-point.y,2));return dis}function computeRotate(o){this.dragging=true;this.data.rotation=this.parent.parent.rotation;var t=o.data.global;this.startPosition={x:t.x,y:t.y};var n=getAngle({x:this.parent.parent.getGlobalPosition().x,y:this.parent.parent.getGlobalPosition().y},t);this.startRotation=n;this.dragSrartPosition={x:this.children[1].getGlobalPosition().x,y:this.children[1].getGlobalPosition().y};this.a=getDistance(this.dragSrartPosition,this.getGlobalPosition());this.b=getDistance(this.getGlobalPosition(),this.parent.getGlobalPosition())}function rotateFunc(o){if(this.dragging){var t=o.data.global,n=getAngle({x:this.parent.parent.getGlobalPosition().x,y:this.parent.parent.getGlobalPosition().y},t),i=true;i=this.startRotation<=Math.PI?n-this.startRotation<Math.PI&&n-this.startRotation>0:!(n-this.startRotation<0&&n-this.startRotation>-Math.PI),this.parent.parent.rotation=n-this.startRotation+this.data.rotation;var e=t.y-this.startPosition.y+this.dragSrartPosition.y-this.parent.getGlobalPosition().y,a=t.x-this.startPosition.x+this.dragSrartPosition.x-this.parent.getGlobalPosition().x,l=Math.sqrt(e*e+a*a),h=this.a,p=this.b,s=0,r=0;l>=h+p?(s=0,r=0):(s=Math.acos((p*p+l*l-h*h)/(2*p*l)),r=Math.acos((h*h+l*l-p*p)/(2*h*l)));isNaN(s)||isNaN(r)||(0==this.parent.parent.parent.facingTo||3==this.parent.parent.parent.facingTo||"hand"==this.parent.parent.name?i?(this.parent.rotation=-s,this.rotation=s+r):(this.parent.rotation=s,this.rotation=-s-r):1==this.parent.parent.parent.facingTo?(this.parent.rotation=s,this.rotation=-s-r):(this.parent.rotation=-s,this.rotation=s+r))}}function initRotate(people){people.outline.removeChildren();var t=new PIXI.Graphics;t.lineStyle(1,16777215,1);var n=people.width,i=people.height;3!=people.facingTo&&6==people.faceIndex&&(i-=130);t.moveTo(0,0);drawDashLine(t,0,0,n,0);drawDashLine(t,n,0,n,i);drawDashLine(t,n,i,0,i);drawDashLine(t,0,i,0,0);people.outline.addChild(t);var a=new PIXI.Sprite(PIXI.loader.resources[PATH+"rotate.png"].texture);a.position.set(-43,-38);a.interactive=true;a.buttonMode=true;a.on("touchstart",function(e){this.dragging=true;var t=e.data.global;this.parent.parent.data.rotation=this.parent.parent.rotation;var n=getAngle({x:this.parent.parent.position.x,y:this.parent.parent.position.y},t);this.startRotation=n}).on("touchmove",function(e){if(this.dragging){var t=e.data.global,n=getAngle({x:this.parent.parent.position.x,y:this.parent.parent.position.y},t);this.parent.parent.rotation=n-this.startRotation+this.parent.parent.data.rotation}}).on("touchend",function(){this.dragging=false});var l=new PIXI.Sprite(PIXI.loader.resources[PATH+"close.png"].texture);l.position.set(n,-38);l.interactive=true;l.buttonMode=true;l.on("tap",function(){PeoplesArr.delete(this.parent.parent);this.parent.parent.parent.removeChild(this.parent.parent);if(PeoplesArr.length){changeMenuStatus(PeoplesArr[PeoplesArr.length-1].sex,PeoplesArr[PeoplesArr.length-1])}else{changeMenuStatus(-100)}});people.outline.addChild(a,l)}function offsetMenu(tagLi){var i=tagLi.index();i>2?tagLi.parent().parent().animate({scrollLeft:130*(i-2)+"px"},300):tagLi.parent().parent().animate({scrollLeft:"0px"},300)}function handleCurPerson(currPerson){if(currPerson!=selectedContainer.children[0]){if(selectedContainer.children.length){var person=selectedContainer.children[0];person.chosen=false;person.outline.visible=false;unselectedContainer.addChild(person);selectedContainer.removeChildren()}changeMenuStatus(currPerson.sex,currPerson);selectedContainer.addChild(currPerson);unselectedContainer.removeChild(currPerson);currPerson.chosen=true}}$(".scroll_bar ul li").bind("click",function(){if(!$(this).hasClass("selected")){$(".category_main").hasClass("close")&&$(".category_main").removeClass("close");$(".selected").removeClass("selected");$(this).addClass("selected");var curIndex=$(this).index();var n=PeoplesArr[PeoplesArr.length-1];if(n){curIndex>0&&curIndex<5&&(n.currentSelectIndex=curIndex);itemAnimate(n)}$(".category_item").hide();$(".category_item").eq(curIndex).show();$(".black_arrow").css({left:100*curIndex});curIndex>3?$(".scroll_bar").animate({scrollLeft:"50px"},300):$(".scroll_bar").animate({scrollLeft:"0px"},300)}});$(".arrow_box").bind("click",function(){if($(".category_main").hasClass("close")){$(".category_main").removeClass("close");$(".black_arrow").show()}else{$(".category_main").addClass("close");$(".black_arrow").hide()}});$(".category_people li").bind("click",function(){var i=$(this).index();$(".category_guide").hide();$(".save").show();$(".category_people li").removeClass("active");$(this).addClass("active");if(!selectedContainer.children.length){var newPeople=createNewPeople(i);selectedContainer.addChild(newPeople)}else if(1==selectedContainer.children.length){var curr=selectedContainer.children[0];unselectedContainer.addChild(curr);curr.chosen=false;curr.outline.visible=false;selectedContainer.removeChildren();var newPeople=createNewPeople(i);selectedContainer.addChild(newPeople)}setTimeout(function(){$(".category_people li").eq(i).removeClass("active")},300)});$(".man_facingTo li").bind("click",function(){var currPerson=PeoplesArr[PeoplesArr.length-1];handleCurPerson(currPerson);var i=$(this).index();$(".man_facingTo li").removeClass("active");$(this).addClass("active");changeFacingTo(currPerson,i)});$(".woman_facingTo li").bind("click",function(){var currPerson=PeoplesArr[PeoplesArr.length-1];handleCurPerson(currPerson);var index=$(this).index();$(".woman_facingTo li").removeClass("active");$(this).addClass("active");changeFacingTo(currPerson,index)});$(".man_cloth li").bind("click",function(){var currPerson=PeoplesArr[PeoplesArr.length-1];handleCurPerson(currPerson);var index=$(this).index();currPerson.clothIndex=index;$(".man_cloth li").removeClass("active");$(this).addClass("active");changeCloth(currPerson);reDrawPeople(currPerson,manClothsAll[currPerson.facingTo][index]);offsetMenu($(this))});$(".woman_cloth li").bind("click",function(){var currPerson=PeoplesArr[PeoplesArr.length-1];handleCurPerson(currPerson);var index=$(this).index();currPerson.clothIndex=index;$(".woman_cloth li").removeClass("active");$(this).addClass("active");changeCloth(currPerson);reDrawPeople(currPerson,womanClothsAll[currPerson.facingTo][index]);offsetMenu($(this))});$(".man_face li").bind("click",function(){var currPerson=PeoplesArr[PeoplesArr.length-1];handleCurPerson(currPerson);var index=$(this).index();$(".man_face li").removeClass("active");$(this).addClass("active");changeFace(currPerson,index);offsetMenu($(this))});$(".woman_face li").bind("click",function(){var currPerson=PeoplesArr[PeoplesArr.length-1];handleCurPerson(currPerson);var index=$(this).index();$(".woman_face li").removeClass("active");$(this).addClass("active");changeFace(currPerson,index);offsetMenu($(this))});$(".man_hair li").bind("click",function(){var currPerson=PeoplesArr[PeoplesArr.length-1];handleCurPerson(currPerson);var index=$(this).index();$(".man_hair li").removeClass("active");$(this).addClass("active");changeHair(currPerson,index);offsetMenu($(this))});$(".woman_hair li").bind("click",function(){var currPerson=PeoplesArr[PeoplesArr.length-1];handleCurPerson(currPerson);var index=$(this).index();$(".woman_hair li").removeClass("active");$(this).addClass("active");changeHair(currPerson,index);offsetMenu($(this))});$(".room li").bind("click",function(){$(".save").show();var index=$(this).index();$(".room li").removeClass("active");$(this).addClass("active");changeRooms(index)});$(".others li").bind("click",function(){$(".save").show();var index=$(this).index();$(".others li").removeClass("active");$(this).addClass("active");addOthers(index);offsetMenu($(this));setTimeout(function(){$(".others li").eq(index).removeClass("active")},300)});$(".flag li").bind("click",function(){$(".save").show();var index=$(this).index();$(".flag li").removeClass("active");$(this).addClass("active");changeFlag(index);offsetMenu($(this));setTimeout(function(){$(".flag li").eq(index).removeClass("active")},300)});$(".start").bind("click",function(){$(".welcome_layer").fadeOut(300);$(".world_cup_layer").show()});$(".welcome_layer").bind("click",function(){$(".welcome_layer").fadeOut(300);$(".world_cup_layer").show()});$(".guide").bind("click",function(){$(".guide").fadeOut(300)});$(".save").bind("click",function(){$(".category").hide();new TWEEN.Tween(thirdContainer.scale).to({x:.933,y:.933},200).onUpdate(function(){thirdContainer.position.set((1-this.x)/.067*25,(1-this.y)/.067*25)}).start();if(selectedContainer.children.length){for(var i=0;i<selectedContainer.children.length;i++){var person=selectedContainer.children[i];person.chosen=false;person.outline.visible=false;unselectedContainer.addChild(person);selectedContainer.removeChild(person)}}shareContainer.visible=true;setTimeout(function(){var img=new Image;img.src=$("canvas")[0].toDataURL("image/png");$(".result_img").append(img);$(".result_img").show();$(".saved_img").append(img);$(".saved_img").show();setTimeout(function(){$(".saved_guide").fadeIn(300);setTimeout(function(){$(".saved_guide").fadeOut(300)},3e3)},500)},230)});setTimeout(function(){$("#firstPage").addClass("loaded")},200);setTimeout(function(){$("#firstPage").fadeOut(500);$("#welcomePage").fadeIn(500)},2800)}(jQuery);Array.prototype.indexOf=function(i){for(var t=0;t<this.length;t++){if(this[t]==i)return t}return-1};Array.prototype.delete=function(i){var t=this.indexOf(i);t>-1&&this.splice(t,1)};function getAngle(i,t){var e=t.x-i.x;var a=t.y-i.y;var n=Math.acos(a/Math.sqrt(e*e+a*a));if(e>=0&&a>=0){n=2*Math.PI-n}else{if(e>=0&&a<=0){n=2*Math.PI-n}}return n}function drawDashLine(i,t,e,a,n,o){o=undefined===o?5:o;var r=Math.sqrt(Math.pow(a-t,2)+Math.pow(n-e,2));var s=Math.floor(r/o);for(var l=0;l<s;l++){var h=t+(a-t)/s*l;var d=e+(n-e)/s*l;if(l%2==0){i["moveTo"](h,d)}else{i["lineTo"](h,d)}}}!function(o){var s="images/";var r=window.innerHeight,l=750;var X=PIXI.Container;var h=new X;h.width=l;h.height=r;var d=new X;d.width=180;d.height=180;d.position.set(200,150);var c=new X;var g=new X;var f=new X;var v=new X;var p=new X;var m=new X;var u=new X;var x=[];var w=new PIXI.CanvasRenderer(l,r,{backgroundColor:16777215});var b=[s+"rooms/room1.png",s+"rooms/room2.png",s+"rooms/room3.png"];var C=[s+"surprised.png",s+"surprised2.png",s+"slide.png"];var I=[s+"others/1.png",s+"others/2.png",s+"others/3.png",s+"others/4.png",s+"others/5.png",s+"others/6.png",s+"others/7.png",s+"others/8.png",s+"others/9.png",s+"others/10.png",s+"others/11.png",s+"others/12.png",s+"others/13.png",s+"others/14.png",s+"others/15.png",s+"others/16.png"];var y=[s+"flags/flag1.png",s+"flags/flag2.png",s+"flags/flag3.png",s+"flags/flag4.png",s+"flags/flag5.png",s+"flags/flag6.png",s+"flags/flag7.png",s+"flags/flag8.png",s+"flags/flag9.png",s+"flags/flag10.png"];var _=[manCloths,manLeftCloths,manRightCloths,manBackCloths];var P=[manFace,manLeftFace,manRightFace,manBackFace];var T=[manHair,manLeftHair,manRightHair,manBackHair];var S=[womanCloths,womanLeftCloths,womanRightCloths,womanBackCloths];var M=[womanFace,womanLeftFace,womanRightFace,womanBackFace];var A=[womanHair,womanLeftHair,womanRightHair,womanBackHair];o("#main_container").append(w.view);o(".welcome_layer, .guide").bind("touchmove",function(i){i.preventDefault()});PIXI.loader.add([s+"rotate.png",s+"close.png",b[0],y[0],C[0],C[1],C[2],s+"bottom_slogan.png",s+"man_left/body.png",s+"man_right/body.png",s+"woman_left/body.png",s+"woman_right/body.png"]).load(i);function i(){l=window.innerWidth;o(".world_cup_layer, .main_layer").width(750).height(r);h.width=l;h.interactive=true;h.on("touchend",function(){for(var i=0;i<c.children.length;i++){var t=c.children[i];new TWEEN.Tween(t.scale).to({x:1,y:1},100).start();if(0===t.sex||1===t.sex){for(var e=0;e<t.children.length;e++){var a=t.children[e];if(a.children[0]&&"bone1"==a.children[0].name){a.children[0].children[1].dragging=false}else{e==t.children.length-1?a.children[1].dragging=false:a.dragging=false}}}else{for(var e=0;e<t.children.length;e++){t.children[0].dragging=false;t.children[1].children[1].dragging=false}}}});k();var i=new PIXI.Graphics;i.beginFill(16777215);i.drawRect(0,r-156,750,150);i.endFill();v.position.set(0,0);var t=new PIXI.Graphics;t.beginFill(16777215);t.drawRect(0,0,2e3,2e3);t.endFill();var e=PIXI.Sprite.fromImage([s+"erweima.png"]);e.width=108,e.height=108,e.position.set(618,r-132);var a=new PIXI.Sprite(PIXI.loader.resources[s+"bottom_slogan.png"].texture);a.position.set(20,r-140);v.visible=false;v.addChild(i,a,e);var n=new PIXI.Graphics;n.beginFill(10053375);n.drawRect(0,0,750,1448);n.endFill();m.mask=n;m.addChild(n,t,g,f,d,u,c);p.addChild(m,v);h.addChild(p);w.render(h);q()}function k(){var i=new PIXI.Sprite(PIXI.loader.resources[C[0]].texture);i.visible=false;var t=new PIXI.Sprite(PIXI.loader.resources[C[1]].texture);t.visible=false;t.x=80;t.y=50;var e=new PIXI.Sprite(PIXI.loader.resources[C[2]].texture);e.visible=false;e.y=30;d.addChild(e);d.addChild(i);d.addChild(t);var a=new PIXI.Sprite(PIXI.loader.resources[b[0]].texture);var n=new PIXI.Sprite(PIXI.loader.resources[y[0]].texture);f.position.set(630,40);g.index=0;f.index=0;g.addChild(a);f.addChild(n);g.interactive=true;g.buttonMode=true;f.interactive=true;f.buttonMode=true;g.on("tap",function(){if(c.children.length){for(var i=0;i<c.children.length;i++){var t=c.children[i];t.chosen=false;t.outline.visible=false;u.addChild(t);c.removeChild(t)}}});f.on("tap",function(){if(c.children.length){for(var i=0;i<c.children.length;i++){var t=c.children[i];t.chosen=false;t.outline.visible=false;u.addChild(t);c.removeChild(t)}}})}function q(){TWEEN.update();requestAnimationFrame(q);w.render(h)}function e(){o("#float-cry").fadeIn();setTimeout(function(){o("#float-cry").fadeOut()},1e3)}var n,L;function a(){if(n){n.stop();n=null}if(L!=null){clearInterval(L);L=null}var i=d.getChildAt(0);i.visible=true;var t=i.x;var e=i.y;var a=true;L=setInterval(function(){if(a){d.getChildAt(1).visible=true;d.getChildAt(2).visible=false}else{d.getChildAt(1).visible=false;d.getChildAt(2).visible=true}a=!a},200);n=new TWEEN.Tween({px:t,py:e}).to({px:t+250,py:e},1500).onStart(function(){}).onUpdate(function(){i.x=this.px;i.y=this.py}).onStop(function(){i.x=t;i.y=e;i.visible=false;clearInterval(L);d.getChildAt(1).visible=false;d.getChildAt(2).visible=false}).onComplete(function(){i.x=t;i.y=e;i.visible=false;clearInterval(L);d.getChildAt(1).visible=false;d.getChildAt(2).visible=false}).start()}function R(i){var t=new X;x.push(t);t.chosen=true;t.interactive=true;t.buttonMode=true;t.on("touchstart",function(){new TWEEN.Tween(this.scale).to({x:1.015,y:1.015},100).start();if(!this.chosen){this.chosen=true;this.outline.visible=true;if(c.children.length){var i=c.children[0];i.chosen=false;i.outline.visible=false;u.addChild(i);c.removeChildren()}x.delete(this);x.push(this);G(this.sex,t);c.addChild(this);u.removeChild(this)}}).on("touchend",function(){new TWEEN.Tween(this.scale).to({x:1,y:1},100).start()});var e;i==0?e=z[0]:e=Z[0];t.data=JSON.parse(JSON.stringify(e));var a=50*Math.random()-50,n=50*Math.random()-50;t.globalPosition={x:t.data.globalPosition.x+a,y:t.data.globalPosition.y+n};t.sex=i;t.facingTo=0;t.faceIndex=0;t.hairIndex=0;t.clothIndex=0;if(i==0){j(t,{face:P[t.facingTo][t.faceIndex],hair:T[t.facingTo][t.hairIndex]});B(t,_[0][0]);setTimeout(function(){Y(t)},100)}else{j(t,{face:M[t.facingTo][t.faceIndex],hair:A[t.facingTo][t.hairIndex]});B(t,S[0][0]);setTimeout(function(){Y(t)},100)}F(i,t);return t}function F(i,t){if(i==0){o(".man_cloth").show();o(".woman_cloth").hide();o(".man_facingTo").show();o(".woman_facingTo").hide();o(".man_hair").show();o(".woman_hair").hide();o(".man_face").show();o(".woman_face").hide();o(".man_cloth li").removeClass("active");o(".man_cloth li").eq(t.clothIndex).addClass("active");o(".man_facingTo li").removeClass("active");o(".man_facingTo li").eq(t.facingTo).addClass("active");o(".man_face li").removeClass("active");o(".man_face li").eq(t.faceIndex).addClass("active");o(".man_hair li").removeClass("active");o(".man_hair li").eq(t.hairIndex).addClass("active");N(t);t.currentSelectIndex=1}else if(i==1){o(".man_cloth").hide();o(".woman_cloth").show();o(".man_facingTo").hide();o(".woman_facingTo").show();o(".man_hair").hide();o(".woman_hair").show();o(".woman_face").show();o(".man_face").hide();o(".woman_cloth li").removeClass("active");o(".woman_cloth li").eq(t.clothIndex).addClass("active");o(".woman_facingTo li").removeClass("active");o(".woman_facingTo li").eq(t.facingTo).addClass("active");o(".woman_face li").removeClass("active");o(".woman_face li").eq(t.faceIndex).addClass("active");o(".woman_hair li").removeClass("active");o(".woman_hair li").eq(t.hairIndex).addClass("active");N(t);t.currentSelectIndex=1}}function G(i,t){if(i==0){o(".man_cloth").show();o(".woman_cloth").hide();o(".man_facingTo").show();o(".woman_facingTo").hide();o(".woman_face").hide();o(".man_face").show();o(".man_hair").show();o(".woman_hair").hide();o(".man_cloth li").removeClass("active");o(".man_cloth li").eq(t.clothIndex).addClass("active");o(".man_facingTo li").removeClass("active");o(".man_facingTo li").eq(t.facingTo).addClass("active");o(".man_face li").removeClass("active");o(".man_face li").eq(t.faceIndex).addClass("active");o(".man_hair li").removeClass("active");o(".man_hair li").eq(t.hairIndex).addClass("active");N(t);o(".selected").removeClass("selected");o(".category_item").hide();o(".category_item").eq(t.currentSelectIndex).show();o(".scroll_bar ul li").eq(t.currentSelectIndex).addClass("selected")}else if(i==1){o(".man_cloth").hide();o(".woman_cloth").show();o(".man_facingTo").hide();o(".woman_facingTo").show();o(".man_hair").hide();o(".woman_hair").show();o(".man_face").hide();o(".woman_face").show();o(".woman_cloth li").removeClass("active");o(".woman_cloth li").eq(t.clothIndex).addClass("active");o(".woman_facingTo li").removeClass("active");o(".woman_facingTo li").eq(t.facingTo).addClass("active");o(".woman_face li").removeClass("active");o(".woman_face li").eq(t.faceIndex).addClass("active");o(".woman_hair li").removeClass("active");o(".woman_hair li").eq(t.hairIndex).addClass("active");N(t);o(".selected").removeClass("selected");o(".category_item").hide();o(".category_item").eq(t.currentSelectIndex).show();o(".scroll_bar ul li").eq(t.currentSelectIndex).addClass("selected")}else if(i==-100){o(".man_cloth").hide();o(".woman_cloth").hide();o(".man_facingTo").hide();o(".woman_facingTo").hide();o(".man_hair").hide();o(".woman_hair").hide();o(".man_face").hide();o(".woman_face").hide();o(".category_guide").show()}}function E(i,t){if(i.facingTo==t){return}i.facingTo=t;if(i.sex==0){i.removeChildren();i.data=JSON.parse(JSON.stringify(z[t]));j(i,{face:P[t][i.faceIndex],hair:T[t][i.hairIndex]});B(i,_[t][i.clothIndex]);setTimeout(function(){Y(i)},100)}else if(1==i.sex){i.removeChildren();i.data=JSON.parse(JSON.stringify(Z[t]));j(i,{face:M[t][i.faceIndex],hair:A[t][i.hairIndex]});B(i,S[t][i.clothIndex]);setTimeout(function(){Y(i)},100)}}function N(i){if(i){i.clothIndex&&i.clothIndex>2?o(".cloth").animate({scrollLeft:130*(i.clothIndex-2)+"px"},300):o(".cloth").animate({scrollLeft:"0px"},300);i.facingTo&&i.facingTo>2?o(".facingTo").animate({scrollLeft:130*(i.facingTo-2)+"px"},300):o(".facingTo").animate({scrollLeft:"0px"},300);i.faceIndex&&i.faceIndex>2?o(".face").animate({scrollLeft:130*(i.faceIndex-2)+"px"},300):o(".face").animate({scrollLeft:"0px"},300);i.hairIndex&&i.hairIndex>2?o(".hair").animate({scrollLeft:130*(i.hairIndex-2)+"px"},300):o(".hair").animate({scrollLeft:"0px"},300)}}function D(i,t){if(i.face&&i.faceIndex!=t&&i.facingTo!=3){i.faceIndex=t;if(0==i.sex){i.head.removeChildAt(1);var e=PIXI.Sprite.fromImage(P[i.facingTo][t].url);e.position.set(P[i.facingTo][t].position.x,P[i.facingTo][t].position.y);i.head.addChildAt(e,1);i.face=e}if(1==i.sex){i.head.removeChildAt(1);var e=PIXI.Sprite.fromImage(M[i.facingTo][t].url);e.position.set(M[i.facingTo][t].position.x,M[i.facingTo][t].position.y);i.head.addChildAt(e,1);i.face=e}}}function O(i,t){if(i.hairIndex!=t){i.hairIndex=t;var e=i.hair.visible;if(0==i.sex){i.head.removeChildAt(i.head.children.length-1);var a=PIXI.Sprite.fromImage(T[i.facingTo][t].url);a.position.set(T[i.facingTo][t].position.x,T[i.facingTo][t].position.y);i.head.addChild(a);i.hair=a}if(1==i.sex){i.head.removeChildAt(i.head.children.length-1);var a=PIXI.Sprite.fromImage(A[i.facingTo][t].url);a.position.set(A[i.facingTo][t].position.x,A[i.facingTo][t].position.y);i.head.addChild(a);i.hair=a}i.hair.visible=e}}function t(i){if(g.index!=i){g.removeChildren();g.index=i;var t=PIXI.Sprite.fromImage([b[i]]);g.addChild(t)}}function H(i){a();e();if(f.index!=i){f.removeChildren();f.index=i;var t=PIXI.Sprite.fromImage([y[i]]);f.addChild(t)}}function U(i){if(c.children.length){var t=c.children[0];t.chosen=false;t.outline.visible=false;u.addChild(t);c.removeChildren()}var e=new X;e.chosen=true;e.interactive=true;e.buttonMode=true;e.on("touchstart",function(){new TWEEN.Tween(this.scale).to({x:1.015,y:1.015},100).start();if(!this.chosen){this.chosen=true;this.outline.visible=true;if(c.children.length){var i=c.children[0];i.chosen=false;i.outline.visible=false;u.addChild(i);c.removeChildren()}c.addChild(this);u.removeChild(this)}});e.data={};var a=50*Math.random()-50;var n=50*Math.random()-50;e.globalPosition={x:200+a,y:500+n};e.position.set(e.globalPosition.x,e.globalPosition.y);var o=PIXI.Sprite.fromImage(I[i]);o.interactive=true;o.buttonMode=true;var r=new X;e.addChild(o,r);e.outline=r;o.texture.baseTexture.hasLoaded?W(e):o.texture.baseTexture.on("loaded",function(){W(e)});c.addChild(e)}function W(i){i.outline.removeChildren();var t=new PIXI.Graphics;t.lineStyle(1,16777215,1);var e=i.width,a=i.height;i.pivot.set(e/2,a/2);i.position.set(i.globalPosition.x+e/2,i.globalPosition.y+a/2);var n=20;t.moveTo(-n,-n);drawDashLine(t,-n,-n,e+n,-n);drawDashLine(t,e+n,-n,e+n,a+n);drawDashLine(t,e+n,a+n,-n,a+n);drawDashLine(t,-n,a+n,-n,-n);i.outline.addChild(t);i.children[0].on("touchstart",function(i){this.dragging=true;this.startPosition={x:i.data.global.x,y:i.data.global.y}}).on("touchmove",function(i){if(this.dragging){this.newPosition={x:i.data.global.x,y:i.data.global.y};var t=this.newPosition.x-this.startPosition.x+this.parent.globalPosition.x+this.parent.pivot._x;var e=this.newPosition.y-this.startPosition.y+this.parent.globalPosition.y+this.parent.pivot._y;this.parent.position.set(t,e)}}).on("touchend",function(){this.dragging=false;this.parent.globalPosition.x=this.parent.position.x-this.parent.pivot._x;this.parent.globalPosition.y=this.parent.position.y-this.parent.pivot._y});var o=new PIXI.Sprite(PIXI.loader.resources[s+"rotate.png"].texture);o.position.set(-n-43,-n-38);o.interactive=true;o.buttonMode=true;o.on("touchstart",function(i){this.dragging=true;var t=i.data.global;this.parent.parent.data.rotation=this.parent.parent.rotation;var e=getAngle({x:this.parent.parent.position.x,y:this.parent.parent.position.y},t);this.startRotation=e}).on("touchmove",function(i){if(this.dragging){var t=i.data.global,e=getAngle({x:this.parent.parent.position.x,y:this.parent.parent.position.y},t);this.parent.parent.rotation=e-this.startRotation+this.parent.parent.data.rotation}}).on("touchend",function(){this.dragging=false});var r=new PIXI.Sprite(PIXI.loader.resources[s+"close.png"].texture);r.position.set(e+n,-n-38);r.interactive=true;r.buttonMode=true;r.on("tap",function(){this.parent.parent.parent.removeChild(this.parent.parent)});i.outline.addChild(o,r)}function B(i,t){var e=i.body,a=PIXI.Sprite.fromImage(t.clothUrl);a.position.set(t.clothPosition.x,t.clothPosition.y);if(t.hatUrl){i.hair.visible=false;var n=PIXI.Sprite.fromImage(t.hatUrl);n.position.set(t.hatPosition.x,t.hatPosition.y);i.head.addChildAt(n,2)}for(var o=(i.boneData,0);o<4;o++){var r=i.boneData[o];if(t.part[o][0]){var s=PIXI.Sprite.fromImage(t.part[o][0]);s.interactive=true;s.buttonMode=true;s.on("touchstart",function(i){K.call(this.parent.children[1],i)}).on("touchmove",function(i){V.call(this.parent.children[1],i)});s.position.set(t.bones[o].bone1.position.x,t.bones[o].bone1.position.y);s.name="addEdCloth";r.children[0].addChild(s)}if(t.part[o][1]){var l=PIXI.Sprite.fromImage(t.part[o][1]);l.position.set(t.bones[o].bone2.position.x,t.bones[o].bone2.position.y);l.name="addEdCloth";r.children[0].children[1].addChild(l)}}e.addChildAt(a,1)}function J(i){if(i.body.children.length>1){i.hair.visible=true;if(i.head.children.length==4){i.head.removeChildAt(2)}else{3==i.facingTo&&3==i.head.children.length&&i.head.removeChildAt(2)}var t=i.body;t.removeChildAt(t.children.length-1);for(var e=0;e<4;e++){var a=i.boneData[e];if("addEdCloth"==a.children[0].children[a.children[0].children.length-1].name){a.children[0].removeChildAt(a.children[0].children.length-1)}if("addEdCloth"==a.children[0].children[1].children[a.children[0].children[1].children.length-1].name){a.children[0].children[1].removeChildAt(a.children[0].children[1].children.length-1)}}}}function j(i,t){var e=i.data.bones;var a=new X;var n=new X;a.position.set(i.data.bodyPosition.x,i.data.bodyPosition.y);n.position.set(i.data.bodyPosition.x+i.data.headPosition.x,i.data.bodyPosition.y+i.data.headPosition.y);var o=PIXI.Sprite.fromImage(i.data.bodyUrl);o.position.set(i.data.bodyImgPosition.x,i.data.bodyImgPosition.y);a.addChild(o);var r=PIXI.Sprite.fromImage(i.data.headUrl);n.addChild(r);if(t.face&&t.face.url){var s=PIXI.Sprite.fromImage(t.face.url);s.position.set(t.face.position.x,t.face.position.y);i.face=s;n.addChild(s)}var l=PIXI.Sprite.fromImage(t.hair.url);l.position.set(t.hair.position.x,t.hair.position.y);i.hair=l;n.addChild(l);a.interactive=true;a.buttonMode=true;a.on("touchstart",function(i){this.dragging=true;this.startPosition={x:i.data.global.x,y:i.data.global.y}}).on("touchmove",function(i){if(this.dragging){this.newPosition={x:i.data.global.x,y:i.data.global.y};var t=this.newPosition.x-this.startPosition.x+this.parent.globalPosition.x+this.parent.pivot._x;var e=this.newPosition.y-this.startPosition.y+this.parent.globalPosition.y+this.parent.pivot._y;this.parent.position.set(t,e)}}).on("touchend",function(){this.dragging=false;this.parent.globalPosition.x=this.parent.position.x-this.parent.pivot._x;this.parent.globalPosition.y=this.parent.position.y-this.parent.pivot._y});n.interactive=true;n.buttonMode=true;n.on("touchstart",function(i){this.dragging=true;this.startPosition={x:i.data.global.x,y:i.data.global.y}}).on("touchmove",function(i){if(this.dragging){this.newPosition={x:i.data.global.x,y:i.data.global.y};var t=this.newPosition.x-this.startPosition.x+this.parent.globalPosition.x+this.parent.pivot._x;var e=this.newPosition.y-this.startPosition.y+this.parent.globalPosition.y+this.parent.pivot._y;this.parent.position.set(t,e)}}).on("touchend",function(){this.dragging=false;this.parent.globalPosition.x=this.parent.position.x-this.parent.pivot._x;this.parent.globalPosition.y=this.parent.position.y-this.parent.pivot._y});i.head=n;i.body=a;var h=new X;h.name="hand";var d=new X;d.name="hand";var c=new X;c.name="leg";var g=new X;g.name="leg";var f=new X,v=[h,d,c,g];i.boneData=v;for(var p=0;p<e.length;p++){var m=v[p],u=e[p],x=u.bone1,w=u.bone2;m.position.set(x.position.x+x.pivot.x,x.position.y+x.pivot.y);m.pivot.set(x.pivot.x,x.pivot.y);if(e[p].boneRotate){m.rotation=e[p].boneRotate}var b=new X;b.name="bone1";b.position.set(x.pivot.x,x.pivot.y);b.pivot.set(x.pivot.x,x.pivot.y);b.rotation=e[p].bone1.rotation;var C=PIXI.Sprite.fromImage(i.data.part[p][0]);b.addChild(C);C.interactive=true;C.buttonMode=true;C.on("touchstart",function(i){K.call(this.parent.children[1],i)}).on("touchmove",function(i){V.call(this.parent.children[1],i)});var I=new PIXI.Graphics;I.beginFill(65535);I.drawCircle(0,0,2);I.endFill();I.position.set(x.position.x+x.pivot.x,x.position.y+x.pivot.y);var y=new PIXI.Graphics;y.beginFill(65535);y.drawCircle(0,0,2);y.endFill();y.position.set(w.position.x+w.pivot.x,w.position.y+w.pivot.y);f.addChild(I);var _=new X;_.name="bone2";var P=PIXI.Sprite.fromImage(i.data.part[p][1]),T=new PIXI.Graphics;T.position.set(u.end.position.x,u.end.position.y);_.addChild(P,T);_.data=e[p].bone2;_.rotation=e[p].bone2.rotation;_.startRotation=0;_.pivot.set(w.pivot.x,w.pivot.y);_.position.set(w.position.x+w.pivot.x,w.position.y+w.pivot.y);_.interactive=true;_.buttonMode=true;_.on("touchstart",K).on("touchmove",V);b.addChild(_);m.addChild(b,y)}if(i.facingTo===0){i.addChild(c,g,a,h,d,f,n)}else if(i.facingTo===3){i.addChild(c,g,h,d,a,f,n)}else if(2==i.facingTo){i.addChild(h,c,g,a,d,f,n)}else if(1==i.facingTo){i.addChild(d,c,g,a,h,f,n)}var S=new X;i.outline=S;i.addChild(S);if(1==i.facingTo){i.pivot.set(0,i.height/2);i.position.set(i.globalPosition.x+i.width/2,i.globalPosition.y+i.height/2);0==i.sex?i.globalPosition.x+=150:i.globalPosition.x+=130;i.outline.position.set(-i.width/2,0)}else{if(0==i.pivot._x){0==i.sex?i.globalPosition.x-=150:1==i.sex&&(i.globalPosition.x-=130)}i.pivot.set(i.width/2,i.height/2);i.position.set(i.globalPosition.x+i.width/2,i.globalPosition.y+i.height/2)}}function Q(i,t){var e=Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2));return e}function K(i){this.dragging=true;this.data.rotation=this.parent.parent.rotation;var t=i.data.global;this.startPosition={x:t.x,y:t.y};var e=getAngle({x:this.parent.parent.getGlobalPosition().x,y:this.parent.parent.getGlobalPosition().y},t);this.startRotation=e;this.dragSrartPosition={x:this.children[1].getGlobalPosition().x,y:this.children[1].getGlobalPosition().y};this.a=Q(this.dragSrartPosition,this.getGlobalPosition());this.b=Q(this.getGlobalPosition(),this.parent.getGlobalPosition())}function V(i){if(this.dragging){var t=i.data.global,e=getAngle({x:this.parent.parent.getGlobalPosition().x,y:this.parent.parent.getGlobalPosition().y},t),a=true;a=this.startRotation<=Math.PI?e-this.startRotation<Math.PI&&e-this.startRotation>0:!(e-this.startRotation<0&&e-this.startRotation>-Math.PI),this.parent.parent.rotation=e-this.startRotation+this.data.rotation;var n=t.y-this.startPosition.y+this.dragSrartPosition.y-this.parent.getGlobalPosition().y,o=t.x-this.startPosition.x+this.dragSrartPosition.x-this.parent.getGlobalPosition().x,r=Math.sqrt(n*n+o*o),s=this.a,l=this.b,h=0,d=0;r>=s+l?(h=0,d=0):(h=Math.acos((l*l+r*r-s*s)/(2*l*r)),d=Math.acos((s*s+r*r-l*l)/(2*s*r)));isNaN(h)||isNaN(d)||(0==this.parent.parent.parent.facingTo||3==this.parent.parent.parent.facingTo||"hand"==this.parent.parent.name?a?(this.parent.rotation=-h,this.rotation=h+d):(this.parent.rotation=h,this.rotation=-h-d):1==this.parent.parent.parent.facingTo?(this.parent.rotation=h,this.rotation=-h-d):(this.parent.rotation=-h,this.rotation=h+d))}}function Y(i){i.outline.removeChildren();var t=new PIXI.Graphics;t.lineStyle(1,16777215,1);var e=i.width,a=i.height;3!=i.facingTo&&6==i.faceIndex&&(a-=130);t.moveTo(0,0);drawDashLine(t,0,0,e,0);drawDashLine(t,e,0,e,a);drawDashLine(t,e,a,0,a);drawDashLine(t,0,a,0,0);i.outline.addChild(t);var n=new PIXI.Sprite(PIXI.loader.resources[s+"rotate.png"].texture);n.position.set(-43,-38);n.interactive=true;n.buttonMode=true;n.on("touchstart",function(i){this.dragging=true;var t=i.data.global;this.parent.parent.data.rotation=this.parent.parent.rotation;var e=getAngle({x:this.parent.parent.position.x,y:this.parent.parent.position.y},t);this.startRotation=e}).on("touchmove",function(i){if(this.dragging){var t=i.data.global,e=getAngle({x:this.parent.parent.position.x,y:this.parent.parent.position.y},t);this.parent.parent.rotation=e-this.startRotation+this.parent.parent.data.rotation}}).on("touchend",function(){this.dragging=false});var o=new PIXI.Sprite(PIXI.loader.resources[s+"close.png"].texture);o.position.set(e,-38);o.interactive=true;o.buttonMode=true;o.on("tap",function(){x.delete(this.parent.parent);this.parent.parent.parent.removeChild(this.parent.parent);if(x.length){G(x[x.length-1].sex,x[x.length-1])}else{G(-100)}});i.outline.addChild(n,o)}function $(i){var t=i.index();t>2?i.parent().parent().animate({scrollLeft:130*(t-2)+"px"},300):i.parent().parent().animate({scrollLeft:"0px"},300)}function ii(i){if(i!=c.children[0]){if(c.children.length){var t=c.children[0];t.chosen=false;t.outline.visible=false;u.addChild(t);c.removeChildren()}G(i.sex,i);c.addChild(i);u.removeChild(i);i.chosen=true}}o(".scroll_bar ul li").bind("click",function(){if(!o(this).hasClass("selected")){o(".category_main").hasClass("close")&&o(".category_main").removeClass("close");o(".selected").removeClass("selected");o(this).addClass("selected");var i=o(this).index();var t=x[x.length-1];if(t){i>0&&i<5&&(t.currentSelectIndex=i);N(t)}o(".category_item").hide();o(".category_item").eq(i).show();o(".black_arrow").css({left:100*i});i>3?o(".scroll_bar").animate({scrollLeft:"50px"},300):o(".scroll_bar").animate({scrollLeft:"0px"},300)}});o(".arrow_box").bind("click",function(){if(o(".category_main").hasClass("close")){o(".category_main").removeClass("close");o(".black_arrow").show()}else{o(".category_main").addClass("close");o(".black_arrow").hide()}});o(".category_people li").bind("click",function(){var i=o(this).index();o(".category_guide").hide();o(".save").show();o(".category_people li").removeClass("active");o(this).addClass("active");if(!c.children.length){var t=R(i);c.addChild(t)}else if(1==c.children.length){var e=c.children[0];u.addChild(e);e.chosen=false;e.outline.visible=false;c.removeChildren();var t=R(i);c.addChild(t)}setTimeout(function(){o(".category_people li").eq(i).removeClass("active")},300)});o(".man_facingTo li").bind("click",function(){var i=x[x.length-1];ii(i);var t=o(this).index();o(".man_facingTo li").removeClass("active");o(this).addClass("active");E(i,t)});o(".woman_facingTo li").bind("click",function(){var i=x[x.length-1];ii(i);var t=o(this).index();o(".woman_facingTo li").removeClass("active");o(this).addClass("active");E(i,t)});o(".man_cloth li").bind("click",function(){var i=x[x.length-1];ii(i);var t=o(this).index();i.clothIndex=t;o(".man_cloth li").removeClass("active");o(this).addClass("active");J(i);B(i,_[i.facingTo][t]);$(o(this))});o(".woman_cloth li").bind("click",function(){var i=x[x.length-1];ii(i);var t=o(this).index();i.clothIndex=t;o(".woman_cloth li").removeClass("active");o(this).addClass("active");J(i);B(i,S[i.facingTo][t]);$(o(this))});o(".man_face li").bind("click",function(){var i=x[x.length-1];ii(i);var t=o(this).index();o(".man_face li").removeClass("active");o(this).addClass("active");D(i,t);$(o(this))});o(".woman_face li").bind("click",function(){var i=x[x.length-1];ii(i);var t=o(this).index();o(".woman_face li").removeClass("active");o(this).addClass("active");D(i,t);$(o(this))});o(".man_hair li").bind("click",function(){var i=x[x.length-1];ii(i);var t=o(this).index();o(".man_hair li").removeClass("active");o(this).addClass("active");O(i,t);$(o(this))});o(".woman_hair li").bind("click",function(){var i=x[x.length-1];ii(i);var t=o(this).index();o(".woman_hair li").removeClass("active");o(this).addClass("active");O(i,t);$(o(this))});o(".room li").bind("click",function(){o(".save").show();var i=o(this).index();o(".room li").removeClass("active");o(this).addClass("active");t(i)});o(".others li").bind("click",function(){o(".save").show();var i=o(this).index();o(".others li").removeClass("active");o(this).addClass("active");U(i);$(o(this));setTimeout(function(){o(".others li").eq(i).removeClass("active")},300)});o(".flag li").bind("click",function(){o(".save").show();var i=o(this).index();o(".flag li").removeClass("active");o(this).addClass("active");H(i);$(o(this));setTimeout(function(){o(".flag li").eq(i).removeClass("active")},300)});o(".start").bind("click",function(){o(".welcome_layer").fadeOut(300);o(".world_cup_layer").show()});o(".welcome_layer").bind("click",function(){o(".welcome_layer").fadeOut(300);o(".world_cup_layer").show()});o(".guide").bind("click",function(){o(".guide").fadeOut(300)});o(".others ul").width(2120);o(".save").bind("click",function(){o(".category").hide();new TWEEN.Tween(m.scale).to({x:.933,y:.933},200).onUpdate(function(){m.position.set((1-this.x)/.067*25,(1-this.y)/.067*25)}).start();if(c.children.length){for(var i=0;i<c.children.length;i++){var t=c.children[i];t.chosen=false;t.outline.visible=false;u.addChild(t);c.removeChild(t)}}v.visible=true;setTimeout(function(){var i=new Image;i.src=o("canvas")[0].toDataURL("image/png");o(".result_img").append(i);o(".result_img").show();o(".saved_img").append(i);o(".saved_img").show();setTimeout(function(){o(".saved_guide").fadeIn(300);setTimeout(function(){o(".saved_guide").fadeOut(300)},3e3)},500)},230)})}(jQuery);