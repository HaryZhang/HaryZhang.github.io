Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++){if(this[t]==e)return t}return-1};Array.prototype.delete=function(e){var t=this.indexOf(e);t>-1&&this.splice(t,1)};function getAngle(e,t){var i=t.x-e.x;var a=t.y-e.y;var n=Math.acos(a/Math.sqrt(i*i+a*a));if(i>=0&&a>=0){n=2*Math.PI-n}else{if(i>=0&&a<=0){n=2*Math.PI-n}}return n}function drawDashLine(e,t,i,a,n,o){o=undefined===o?5:o;var r=Math.sqrt(Math.pow(a-t,2)+Math.pow(n-i,2));var s=Math.floor(r/o);for(var l=0;l<s;l++){var h=t+(a-t)/s*l;var d=i+(n-i)/s*l;if(l%2==0){e["moveTo"](h,d)}else{e["lineTo"](h,d)}}}!function(s){var l="images/";var h=window.innerHeight,d=750;var S=PIXI.Container;var c=new S;c.width=d;c.height=h;var g=new S;g.width=180;g.height=180;g.position.set(200,150);var f=new S;var v=new S;var p=new S;var m=new S;var u=new S;var x=new S;var w=new S;var r=[];var I=new PIXI.CanvasRenderer(d,h,{backgroundColor:16777215});var C=(PIXI.loader.resources,PIXI.utils.TextureCache,PIXI.Texture,PIXI.Text);var b=["球可以看，发型不可以乱","看球的时候请放下手机","看球也是体育运动","恋爱是看球事业的绊脚石","我拿你当朋友才约你看球","足球与工作，不可兼得","看球其实不重要，重要的其实是吃什么","世界杯是把杀猪刀","别人家的主队，从来都没让我失望过","可以不刷短视频APP了","我常常因为看球，而显得和你们格格不入","猜得再准，也敌不过爆冷","真球迷专属认证","看球是不可能看球的，这辈子都不可能看球的","成年人的世界没有杯"];var o=[l+"rooms/room1.png",l+"rooms/room2.png",l+"rooms/room3.png",l+"rooms/room4.png",l+"rooms/room5.png",l+"rooms/room6.png",l+"rooms/room7.png"];var y=[l+"surprised.png",l+"surprised2.png",l+"slide.png"];var _=[l+"others/1.png",l+"others/2.png",l+"others/3.png",l+"others/4.png",l+"others/5.png",l+"others/6.png",l+"others/7.png",l+"others/8.png",l+"others/9.png",l+"others/10.png",l+"others/11.png",l+"others/12.png",l+"others/13.png",l+"others/14.png",l+"others/15.png",l+"others/16.png",l+"others/17.png",l+"others/18.png",l+"others/19.png",l+"others/20.png",l+"others/21.png",l+"others/22.png",l+"others/23.png",l+"others/24.png",l+"others/25.png",l+"others/26.png",l+"others/27.png",l+"others/28.png",l+"others/29.png",l+"others/30.png"];var P=[l+"flags/flag1.png",l+"flags/flag2.png",l+"flags/flag3.png",l+"flags/flag4.png",l+"flags/flag5.png",l+"flags/flag6.png",l+"flags/flag7.png",l+"flags/flag8.png",l+"flags/flag9.png",l+"flags/flag10.png"];var e=window.navigator.userAgent.toLowerCase();var t=/iphone/gi.test(e)&&812==screen.height&&375==screen.width;if(t){s(".guide_img").css({top:"294px"})}var T=[manCloths,manLeftCloths,manRightCloths,manBackCloths];var X=[manFace,manLeftFace,manRightFace,manBackFace];var M=[manHair,manLeftHair,manRightHair,manBackHair];var A=[womanCloths,womanLeftCloths,womanRightCloths,womanBackCloths];var L=[womanFace,womanLeftFace,womanRightFace,womanBackFace];var k=[womanHair,womanLeftHair,womanRightHair,womanBackHair];s("#main_container").append(I.view);s(".welcome_layer, .guide").bind("touchmove",function(e){e.preventDefault()});PIXI.loader.add([l+"rotate.png",l+"close.png",o[0],P[0],y[0],y[1],y[2],l+"share_slogan.png",l+"man_left/body.png",l+"man_right/body.png",l+"woman_left/body.png",l+"woman_right/body.png"]).load(i);function i(){d=window.innerWidth;s(".world_cup_layer, .main_layer").width(750).height(h);c.width=d;c.interactive=true;c.on("touchend",function(){for(var e=0;e<f.children.length;e++){var t=f.children[e];new TWEEN.Tween(t.scale).to({x:1,y:1},100).start();if(0===t.sex||1===t.sex){for(var i=0;i<t.children.length;i++){var a=t.children[i];if(a.children[0]&&"bone1"==a.children[0].name){a.children[0].children[1].dragging=false}else{i==t.children.length-1?a.children[1].dragging=false:a.dragging=false}}}else{for(var i=0;i<t.children.length;i++){t.children[0].dragging=false;t.children[1].children[1].dragging=false}}}});q();var e=new PIXI.Graphics;e.beginFill(16777215);e.drawRect(0,h-156,750,156);e.endFill();m.position.set(0,0);var t=new PIXI.Graphics;t.beginFill(16777215);t.drawRect(0,0,2e3,2e3);t.endFill();var i=PIXI.Sprite.fromImage([l+"erweima.png"]);i.width=108,i.height=108,i.position.set(618,h-132);var a=new PIXI.Sprite(PIXI.loader.resources[l+"share_slogan.png"].texture);a.position.set(40,h-150);var n=b[Math.floor(Math.random()*b.length)];var o=new C(n,{fontSize:"20px",fill:"#000000"});o.position.set(40,h-50);m.visible=false;m.addChild(e,a,o,i);var r=new PIXI.Graphics;r.beginFill(10053375);r.drawRect(0,0,750,1448);r.endFill();x.mask=r;x.addChild(r,t,v,p,g,w,f);u.addChild(x,m);c.addChild(u);I.render(c);R()}function q(){var e=new PIXI.Sprite(PIXI.loader.resources[y[0]].texture);e.visible=false;var t=new PIXI.Sprite(PIXI.loader.resources[y[1]].texture);t.visible=false;t.x=80;t.y=50;var i=PIXI.Sprite.fromImage([y[2]]);i.visible=false;i.y=30;g.addChild(i);g.addChild(e);g.addChild(t);var a=new PIXI.Sprite(PIXI.loader.resources[o[0]].texture);var n=new PIXI.Sprite(PIXI.loader.resources[P[0]].texture);p.position.set(630,40);v.index=0;p.index=0;v.addChild(a);p.addChild(n);v.interactive=true;v.buttonMode=true;p.interactive=true;p.buttonMode=true;v.on("tap",function(){if(f.children.length){for(var e=0;e<f.children.length;e++){var t=f.children[e];t.chosen=false;t.outline.visible=false;w.addChild(t);f.removeChild(t)}}});p.on("tap",function(){if(f.children.length){for(var e=0;e<f.children.length;e++){var t=f.children[e];t.chosen=false;t.outline.visible=false;w.addChild(t);f.removeChild(t)}}})}function R(){TWEEN.update();requestAnimationFrame(R);I.render(c)}function a(){s("#float-cry").fadeIn();setTimeout(function(){s("#float-cry").fadeOut()},1e3)}var n,F;function G(){if(n){n.stop();n=null}if(F!=null){clearInterval(F);F=null}var e=g.getChildAt(0);e.visible=true;var t=e.x;var i=e.y;var a=true;F=setInterval(function(){if(a){g.getChildAt(1).visible=true;g.getChildAt(2).visible=false}else{g.getChildAt(1).visible=false;g.getChildAt(2).visible=true}a=!a},200);n=new TWEEN.Tween({px:t,py:i}).to({px:t+250,py:i},1500).onStart(function(){}).onUpdate(function(){e.x=this.px;e.y=this.py}).onStop(function(){e.x=t;e.y=i;e.visible=false;clearInterval(F);g.getChildAt(1).visible=false;g.getChildAt(2).visible=false}).onComplete(function(){e.x=t;e.y=i;e.visible=false;clearInterval(F);g.getChildAt(1).visible=false;g.getChildAt(2).visible=false}).start()}function E(e){var t=new S;r.push(t);t.chosen=true;t.interactive=true;t.buttonMode=true;t.on("touchstart",function(){new TWEEN.Tween(this.scale).to({x:1.015,y:1.015},100).start();if(!this.chosen){this.chosen=true;this.outline.visible=true;if(f.children.length){var e=f.children[0];e.chosen=false;e.outline.visible=false;w.addChild(e);f.removeChildren()}r.delete(this);r.push(this);D(this.sex,t);f.addChild(this);w.removeChild(this)}}).on("touchend",function(){new TWEEN.Tween(this.scale).to({x:1,y:1},100).start()});var i;e==0?i=z[0]:i=Z[0];t.data=JSON.parse(JSON.stringify(i));var a=50*Math.random()-50,n=50*Math.random()-50;t.globalPosition={x:t.data.globalPosition.x+a,y:t.data.globalPosition.y+n};t.sex=e;t.facingTo=0;t.faceIndex=0;t.hairIndex=0;t.clothIndex=0;if(e==0){Y(t,{face:X[t.facingTo][t.faceIndex],hair:M[t.facingTo][t.hairIndex]});K(t,T[0][0]);setTimeout(function(){ie(t)},100)}else{Y(t,{face:L[t.facingTo][t.faceIndex],hair:k[t.facingTo][t.hairIndex]});K(t,A[0][0]);setTimeout(function(){ie(t)},100)}N(e,t);return t}function N(e,t){if(e==0){s(".man_cloth").show();s(".woman_cloth").hide();s(".man_facingTo").show();s(".woman_facingTo").hide();s(".man_hair").show();s(".woman_hair").hide();s(".man_face").show();s(".woman_face").hide();s(".man_cloth li").removeClass("active");s(".man_cloth li").eq(t.clothIndex).addClass("active");s(".man_facingTo li").removeClass("active");s(".man_facingTo li").eq(t.facingTo).addClass("active");s(".man_face li").removeClass("active");s(".man_face li").eq(t.faceIndex).addClass("active");s(".man_hair li").removeClass("active");s(".man_hair li").eq(t.hairIndex).addClass("active");H(t);t.currentSelectIndex=1}else if(e==1){s(".man_cloth").hide();s(".woman_cloth").show();s(".man_facingTo").hide();s(".woman_facingTo").show();s(".man_hair").hide();s(".woman_hair").show();s(".woman_face").show();s(".man_face").hide();s(".woman_cloth li").removeClass("active");s(".woman_cloth li").eq(t.clothIndex).addClass("active");s(".woman_facingTo li").removeClass("active");s(".woman_facingTo li").eq(t.facingTo).addClass("active");s(".woman_face li").removeClass("active");s(".woman_face li").eq(t.faceIndex).addClass("active");s(".woman_hair li").removeClass("active");s(".woman_hair li").eq(t.hairIndex).addClass("active");H(t);t.currentSelectIndex=1}}function D(e,t){if(e==0){s(".man_cloth").show();s(".woman_cloth").hide();s(".man_facingTo").show();s(".woman_facingTo").hide();s(".woman_face").hide();s(".man_face").show();s(".man_hair").show();s(".woman_hair").hide();s(".man_cloth li").removeClass("active");s(".man_cloth li").eq(t.clothIndex).addClass("active");s(".man_facingTo li").removeClass("active");s(".man_facingTo li").eq(t.facingTo).addClass("active");s(".man_face li").removeClass("active");s(".man_face li").eq(t.faceIndex).addClass("active");s(".man_hair li").removeClass("active");s(".man_hair li").eq(t.hairIndex).addClass("active");H(t);s(".selected").removeClass("selected");s(".category_item").hide();s(".category_item").eq(t.currentSelectIndex).show();s(".scroll_bar ul li").eq(t.currentSelectIndex).addClass("selected")}else if(e==1){s(".man_cloth").hide();s(".woman_cloth").show();s(".man_facingTo").hide();s(".woman_facingTo").show();s(".man_hair").hide();s(".woman_hair").show();s(".man_face").hide();s(".woman_face").show();s(".woman_cloth li").removeClass("active");s(".woman_cloth li").eq(t.clothIndex).addClass("active");s(".woman_facingTo li").removeClass("active");s(".woman_facingTo li").eq(t.facingTo).addClass("active");s(".woman_face li").removeClass("active");s(".woman_face li").eq(t.faceIndex).addClass("active");s(".woman_hair li").removeClass("active");s(".woman_hair li").eq(t.hairIndex).addClass("active");H(t);s(".selected").removeClass("selected");s(".category_item").hide();s(".category_item").eq(t.currentSelectIndex).show();s(".scroll_bar ul li").eq(t.currentSelectIndex).addClass("selected")}else if(e==-100){s(".man_cloth").hide();s(".woman_cloth").hide();s(".man_facingTo").hide();s(".woman_facingTo").hide();s(".man_hair").hide();s(".woman_hair").hide();s(".man_face").hide();s(".woman_face").hide();s(".category_guide").show()}}function O(e,t){if(e.facingTo==t){return}e.facingTo=t;if(e.sex==0){e.removeChildren();e.data=JSON.parse(JSON.stringify(z[t]));Y(e,{face:X[t][e.faceIndex],hair:M[t][e.hairIndex]});K(e,T[t][e.clothIndex]);setTimeout(function(){ie(e)},100)}else if(1==e.sex){e.removeChildren();e.data=JSON.parse(JSON.stringify(Z[t]));Y(e,{face:L[t][e.faceIndex],hair:k[t][e.hairIndex]});K(e,A[t][e.clothIndex]);setTimeout(function(){ie(e)},100)}}function H(e){if(e){e.clothIndex&&e.clothIndex>2?s(".cloth").animate({scrollLeft:130*(e.clothIndex-2)+"px"},300):s(".cloth").animate({scrollLeft:"0px"},300);e.facingTo&&e.facingTo>2?s(".facingTo").animate({scrollLeft:130*(e.facingTo-2)+"px"},300):s(".facingTo").animate({scrollLeft:"0px"},300);e.faceIndex&&e.faceIndex>2?s(".face").animate({scrollLeft:130*(e.faceIndex-2)+"px"},300):s(".face").animate({scrollLeft:"0px"},300);e.hairIndex&&e.hairIndex>2?s(".hair").animate({scrollLeft:130*(e.hairIndex-2)+"px"},300):s(".hair").animate({scrollLeft:"0px"},300)}}function U(e,t){if(e.face&&e.faceIndex!=t&&e.facingTo!=3){e.faceIndex=t;if(0==e.sex){e.head.removeChildAt(1);var i=PIXI.Sprite.fromImage(X[e.facingTo][t].url);i.position.set(X[e.facingTo][t].position.x,X[e.facingTo][t].position.y);e.head.addChildAt(i,1);e.face=i}if(1==e.sex){e.head.removeChildAt(1);var i=PIXI.Sprite.fromImage(L[e.facingTo][t].url);i.position.set(L[e.facingTo][t].position.x,L[e.facingTo][t].position.y);e.head.addChildAt(i,1);e.face=i}}}function W(e,t){if(e.hairIndex!=t){e.hairIndex=t;var i=e.hair.visible;if(0==e.sex){e.head.removeChildAt(e.head.children.length-1);var a=PIXI.Sprite.fromImage(M[e.facingTo][t].url);a.position.set(M[e.facingTo][t].position.x,M[e.facingTo][t].position.y);e.head.addChild(a);e.hair=a}if(1==e.sex){e.head.removeChildAt(e.head.children.length-1);var a=PIXI.Sprite.fromImage(k[e.facingTo][t].url);a.position.set(k[e.facingTo][t].position.x,k[e.facingTo][t].position.y);e.head.addChild(a);e.hair=a}e.hair.visible=i}}function B(e){if(v.index!=e){v.removeChildren();v.index=e;var t=PIXI.Sprite.fromImage([o[e]]);v.addChild(t)}}function J(e){G();a();if(p.index!=e){p.removeChildren();p.index=e;var t=PIXI.Sprite.fromImage([P[e]]);p.addChild(t)}}function j(e){if(f.children.length){var t=f.children[0];t.chosen=false;t.outline.visible=false;w.addChild(t);f.removeChildren()}var i=new S;i.chosen=true;i.interactive=true;i.buttonMode=true;i.on("touchstart",function(){new TWEEN.Tween(this.scale).to({x:1.015,y:1.015},100).start();if(!this.chosen){this.chosen=true;this.outline.visible=true;if(f.children.length){var e=f.children[0];e.chosen=false;e.outline.visible=false;w.addChild(e);f.removeChildren()}f.addChild(this);w.removeChild(this)}});i.data={};var a=50*Math.random()-50;var n=50*Math.random()-50;i.globalPosition={x:200+a,y:500+n};i.position.set(i.globalPosition.x,i.globalPosition.y);var o=PIXI.Sprite.fromImage(_[e]);o.interactive=true;o.buttonMode=true;var r=new S;i.addChild(o,r);i.outline=r;o.texture.baseTexture.hasLoaded?Q(i):o.texture.baseTexture.on("loaded",function(){Q(i)});f.addChild(i)}function Q(e){e.outline.removeChildren();var t=new PIXI.Graphics;t.lineStyle(1,16777215,1);var i=e.width,a=e.height;e.pivot.set(i/2,a/2);e.position.set(e.globalPosition.x+i/2,e.globalPosition.y+a/2);var n=20;t.moveTo(-n,-n);drawDashLine(t,-n,-n,i+n,-n);drawDashLine(t,i+n,-n,i+n,a+n);drawDashLine(t,i+n,a+n,-n,a+n);drawDashLine(t,-n,a+n,-n,-n);e.outline.addChild(t);e.children[0].on("touchstart",function(e){this.dragging=true;this.startPosition={x:e.data.global.x,y:e.data.global.y}}).on("touchmove",function(e){if(this.dragging){this.newPosition={x:e.data.global.x,y:e.data.global.y};var t=this.newPosition.x-this.startPosition.x+this.parent.globalPosition.x+this.parent.pivot._x;var i=this.newPosition.y-this.startPosition.y+this.parent.globalPosition.y+this.parent.pivot._y;this.parent.position.set(t,i)}}).on("touchend",function(){this.dragging=false;this.parent.globalPosition.x=this.parent.position.x-this.parent.pivot._x;this.parent.globalPosition.y=this.parent.position.y-this.parent.pivot._y});var o=new PIXI.Sprite(PIXI.loader.resources[l+"rotate.png"].texture);o.position.set(-n-43,-n-38);o.interactive=true;o.buttonMode=true;o.on("touchstart",function(e){this.dragging=true;var t=e.data.global;this.parent.parent.data.rotation=this.parent.parent.rotation;var i=getAngle({x:this.parent.parent.position.x,y:this.parent.parent.position.y},t);this.startRotation=i}).on("touchmove",function(e){if(this.dragging){var t=e.data.global,i=getAngle({x:this.parent.parent.position.x,y:this.parent.parent.position.y},t);this.parent.parent.rotation=i-this.startRotation+this.parent.parent.data.rotation}}).on("touchend",function(){this.dragging=false});var r=new PIXI.Sprite(PIXI.loader.resources[l+"close.png"].texture);r.position.set(i+n,-n-38);r.interactive=true;r.buttonMode=true;r.on("tap",function(){this.parent.parent.parent.removeChild(this.parent.parent)});e.outline.addChild(o,r)}function K(e,t){var i=e.body,a=PIXI.Sprite.fromImage(t.clothUrl);a.position.set(t.clothPosition.x,t.clothPosition.y);if(t.hatUrl){e.hair.visible=false;var n=PIXI.Sprite.fromImage(t.hatUrl);n.position.set(t.hatPosition.x,t.hatPosition.y);e.head.addChildAt(n,2)}for(var o=(e.boneData,0);o<4;o++){var r=e.boneData[o];if(t.part[o][0]){var s=PIXI.Sprite.fromImage(t.part[o][0]);s.interactive=true;s.buttonMode=true;s.on("touchstart",function(e){ee.call(this.parent.children[1],e)}).on("touchmove",function(e){te.call(this.parent.children[1],e)});s.position.set(t.bones[o].bone1.position.x,t.bones[o].bone1.position.y);s.name="addEdCloth";r.children[0].addChild(s)}if(t.part[o][1]){var l=PIXI.Sprite.fromImage(t.part[o][1]);l.position.set(t.bones[o].bone2.position.x,t.bones[o].bone2.position.y);l.name="addEdCloth";r.children[0].children[1].addChild(l)}}i.addChildAt(a,1)}function V(e){if(e.body.children.length>1){e.hair.visible=true;if(e.head.children.length==4){e.head.removeChildAt(2)}else{3==e.facingTo&&3==e.head.children.length&&e.head.removeChildAt(2)}var t=e.body;t.removeChildAt(t.children.length-1);for(var i=0;i<4;i++){var a=e.boneData[i];if("addEdCloth"==a.children[0].children[a.children[0].children.length-1].name){a.children[0].removeChildAt(a.children[0].children.length-1)}if("addEdCloth"==a.children[0].children[1].children[a.children[0].children[1].children.length-1].name){a.children[0].children[1].removeChildAt(a.children[0].children[1].children.length-1)}}}}function Y(e,t){var i=e.data.bones;var a=new S;var n=new S;a.position.set(e.data.bodyPosition.x,e.data.bodyPosition.y);n.position.set(e.data.bodyPosition.x+e.data.headPosition.x,e.data.bodyPosition.y+e.data.headPosition.y);var o=PIXI.Sprite.fromImage(e.data.bodyUrl);o.position.set(e.data.bodyImgPosition.x,e.data.bodyImgPosition.y);a.addChild(o);var r=PIXI.Sprite.fromImage(e.data.headUrl);n.addChild(r);if(t.face&&t.face.url){var s=PIXI.Sprite.fromImage(t.face.url);s.position.set(t.face.position.x,t.face.position.y);e.face=s;n.addChild(s)}var l=PIXI.Sprite.fromImage(t.hair.url);l.position.set(t.hair.position.x,t.hair.position.y);e.hair=l;n.addChild(l);a.interactive=true;a.buttonMode=true;a.on("touchstart",function(e){this.dragging=true;this.startPosition={x:e.data.global.x,y:e.data.global.y}}).on("touchmove",function(e){if(this.dragging){this.newPosition={x:e.data.global.x,y:e.data.global.y};var t=this.newPosition.x-this.startPosition.x+this.parent.globalPosition.x+this.parent.pivot._x;var i=this.newPosition.y-this.startPosition.y+this.parent.globalPosition.y+this.parent.pivot._y;this.parent.position.set(t,i)}}).on("touchend",function(){this.dragging=false;this.parent.globalPosition.x=this.parent.position.x-this.parent.pivot._x;this.parent.globalPosition.y=this.parent.position.y-this.parent.pivot._y});n.interactive=true;n.buttonMode=true;n.on("touchstart",function(e){this.dragging=true;this.startPosition={x:e.data.global.x,y:e.data.global.y}}).on("touchmove",function(e){if(this.dragging){this.newPosition={x:e.data.global.x,y:e.data.global.y};var t=this.newPosition.x-this.startPosition.x+this.parent.globalPosition.x+this.parent.pivot._x;var i=this.newPosition.y-this.startPosition.y+this.parent.globalPosition.y+this.parent.pivot._y;this.parent.position.set(t,i)}}).on("touchend",function(){this.dragging=false;this.parent.globalPosition.x=this.parent.position.x-this.parent.pivot._x;this.parent.globalPosition.y=this.parent.position.y-this.parent.pivot._y});e.head=n;e.body=a;var h=new S;h.name="hand";var d=new S;d.name="hand";var c=new S;c.name="leg";var g=new S;g.name="leg";var f=new S,v=[h,d,c,g];e.boneData=v;for(var p=0;p<i.length;p++){var m=v[p],u=i[p],x=u.bone1,w=u.bone2;m.position.set(x.position.x+x.pivot.x,x.position.y+x.pivot.y);m.pivot.set(x.pivot.x,x.pivot.y);if(i[p].boneRotate){m.rotation=i[p].boneRotate}var I=new S;I.name="bone1";I.position.set(x.pivot.x,x.pivot.y);I.pivot.set(x.pivot.x,x.pivot.y);I.rotation=i[p].bone1.rotation;var C=PIXI.Sprite.fromImage(e.data.part[p][0]);I.addChild(C);C.interactive=true;C.buttonMode=true;C.on("touchstart",function(e){ee.call(this.parent.children[1],e)}).on("touchmove",function(e){te.call(this.parent.children[1],e)});var b=new PIXI.Graphics;b.beginFill(65535);b.drawCircle(0,0,2);b.endFill();b.position.set(x.position.x+x.pivot.x,x.position.y+x.pivot.y);var y=new PIXI.Graphics;y.beginFill(65535);y.drawCircle(0,0,2);y.endFill();y.position.set(w.position.x+w.pivot.x,w.position.y+w.pivot.y);f.addChild(b);var _=new S;_.name="bone2";var P=PIXI.Sprite.fromImage(e.data.part[p][1]),T=new PIXI.Graphics;T.position.set(u.end.position.x,u.end.position.y);_.addChild(P,T);_.data=i[p].bone2;_.rotation=i[p].bone2.rotation;_.startRotation=0;_.pivot.set(w.pivot.x,w.pivot.y);_.position.set(w.position.x+w.pivot.x,w.position.y+w.pivot.y);_.interactive=true;_.buttonMode=true;_.on("touchstart",ee).on("touchmove",te);I.addChild(_);m.addChild(I,y)}if(e.facingTo===0){e.addChild(c,g,a,h,d,f,n)}else if(e.facingTo===3){e.addChild(c,g,h,d,a,f,n)}else if(2==e.facingTo){e.addChild(h,c,g,a,d,f,n)}else if(1==e.facingTo){e.addChild(d,c,g,a,h,f,n)}var X=new S;e.outline=X;e.addChild(X);if(1==e.facingTo){e.pivot.set(0,e.height/2);e.position.set(e.globalPosition.x+e.width/2,e.globalPosition.y+e.height/2);0==e.sex?e.globalPosition.x+=150:e.globalPosition.x+=130;e.outline.position.set(-e.width/2,0)}else{if(0==e.pivot._x){0==e.sex?e.globalPosition.x-=150:1==e.sex&&(e.globalPosition.x-=130)}e.pivot.set(e.width/2,e.height/2);e.position.set(e.globalPosition.x+e.width/2,e.globalPosition.y+e.height/2)}}function $(e,t){var i=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));return i}function ee(e){this.dragging=true;this.data.rotation=this.parent.parent.rotation;var t=e.data.global;this.startPosition={x:t.x,y:t.y};var i=getAngle({x:this.parent.parent.getGlobalPosition().x,y:this.parent.parent.getGlobalPosition().y},t);this.startRotation=i;this.dragSrartPosition={x:this.children[1].getGlobalPosition().x,y:this.children[1].getGlobalPosition().y};this.a=$(this.dragSrartPosition,this.getGlobalPosition());this.b=$(this.getGlobalPosition(),this.parent.getGlobalPosition())}function te(e){if(this.dragging){var t=e.data.global,i=getAngle({x:this.parent.parent.getGlobalPosition().x,y:this.parent.parent.getGlobalPosition().y},t),a=true;a=this.startRotation<=Math.PI?i-this.startRotation<Math.PI&&i-this.startRotation>0:!(i-this.startRotation<0&&i-this.startRotation>-Math.PI),this.parent.parent.rotation=i-this.startRotation+this.data.rotation;var n=t.y-this.startPosition.y+this.dragSrartPosition.y-this.parent.getGlobalPosition().y,o=t.x-this.startPosition.x+this.dragSrartPosition.x-this.parent.getGlobalPosition().x,r=Math.sqrt(n*n+o*o),s=this.a,l=this.b,h=0,d=0;r>=s+l?(h=0,d=0):(h=Math.acos((l*l+r*r-s*s)/(2*l*r)),d=Math.acos((s*s+r*r-l*l)/(2*s*r)));isNaN(h)||isNaN(d)||(0==this.parent.parent.parent.facingTo||3==this.parent.parent.parent.facingTo||"hand"==this.parent.parent.name?a?(this.parent.rotation=-h,this.rotation=h+d):(this.parent.rotation=h,this.rotation=-h-d):1==this.parent.parent.parent.facingTo?(this.parent.rotation=h,this.rotation=-h-d):(this.parent.rotation=-h,this.rotation=h+d))}}function ie(e){e.outline.removeChildren();var t=new PIXI.Graphics;t.lineStyle(1,16777215,1);var i=e.width,a=e.height;3!=e.facingTo&&6==e.faceIndex&&(a-=130);t.moveTo(0,0);drawDashLine(t,0,0,i,0);drawDashLine(t,i,0,i,a);drawDashLine(t,i,a,0,a);drawDashLine(t,0,a,0,0);e.outline.addChild(t);var n=new PIXI.Sprite(PIXI.loader.resources[l+"rotate.png"].texture);n.position.set(-43,-38);n.interactive=true;n.buttonMode=true;n.on("touchstart",function(e){this.dragging=true;var t=e.data.global;this.parent.parent.data.rotation=this.parent.parent.rotation;var i=getAngle({x:this.parent.parent.position.x,y:this.parent.parent.position.y},t);this.startRotation=i}).on("touchmove",function(e){if(this.dragging){var t=e.data.global,i=getAngle({x:this.parent.parent.position.x,y:this.parent.parent.position.y},t);this.parent.parent.rotation=i-this.startRotation+this.parent.parent.data.rotation}}).on("touchend",function(){this.dragging=false});var o=new PIXI.Sprite(PIXI.loader.resources[l+"close.png"].texture);o.position.set(i,-38);o.interactive=true;o.buttonMode=true;o.on("tap",function(){r.delete(this.parent.parent);this.parent.parent.parent.removeChild(this.parent.parent);if(r.length){D(r[r.length-1].sex,r[r.length-1])}else{D(-100)}});e.outline.addChild(n,o)}function ae(e){var t=e.index();t>2?e.parent().parent().animate({scrollLeft:130*(t-2)+"px"},300):e.parent().parent().animate({scrollLeft:"0px"},300)}function ne(e){if(e!=f.children[0]){if(f.children.length){var t=f.children[0];t.chosen=false;t.outline.visible=false;w.addChild(t);f.removeChildren()}D(e.sex,e);f.addChild(e);w.removeChild(e);e.chosen=true}}s(".scroll_bar ul li").bind("click",function(){if(!s(this).hasClass("selected")){s(".category_main").hasClass("close")&&s(".category_main").removeClass("close");s(".selected").removeClass("selected");s(this).addClass("selected");var e=s(this).index();var t=r[r.length-1];if(t){e>0&&e<5&&(t.currentSelectIndex=e);H(t)}s(".category_item").hide();s(".category_item").eq(e).show();s(".black_arrow").css({left:100*e});e>3?s(".scroll_bar").animate({scrollLeft:"50px"},300):s(".scroll_bar").animate({scrollLeft:"0px"},300)}});s(".arrow_box").bind("click",function(){if(s(".category_main").hasClass("close")){s(".category_main").removeClass("close");s(".black_arrow").show()}else{s(".category_main").addClass("close");s(".black_arrow").hide()}});s(".category_people li").bind("click",function(){var e=s(this).index();s(".category_guide").hide();s(".save").show();s(".category_people li").removeClass("active");s(this).addClass("active");if(!f.children.length){var t=E(e);f.addChild(t)}else if(1==f.children.length){var i=f.children[0];w.addChild(i);i.chosen=false;i.outline.visible=false;f.removeChildren();var t=E(e);f.addChild(t)}setTimeout(function(){s(".category_people li").eq(e).removeClass("active")},300)});s(".man_facingTo li").bind("click",function(){var e=r[r.length-1];ne(e);var t=s(this).index();s(".man_facingTo li").removeClass("active");s(this).addClass("active");O(e,t)});s(".woman_facingTo li").bind("click",function(){var e=r[r.length-1];ne(e);var t=s(this).index();s(".woman_facingTo li").removeClass("active");s(this).addClass("active");O(e,t)});s(".man_cloth li").bind("click",function(){var e=r[r.length-1];ne(e);var t=s(this).index();e.clothIndex=t;s(".man_cloth li").removeClass("active");s(this).addClass("active");V(e);K(e,T[e.facingTo][t]);ae(s(this))});s(".woman_cloth li").bind("click",function(){var e=r[r.length-1];ne(e);var t=s(this).index();e.clothIndex=t;s(".woman_cloth li").removeClass("active");s(this).addClass("active");V(e);K(e,A[e.facingTo][t]);ae(s(this))});s(".man_face li").bind("click",function(){var e=r[r.length-1];ne(e);var t=s(this).index();s(".man_face li").removeClass("active");s(this).addClass("active");U(e,t);ae(s(this))});s(".woman_face li").bind("click",function(){var e=r[r.length-1];ne(e);var t=s(this).index();s(".woman_face li").removeClass("active");s(this).addClass("active");U(e,t);ae(s(this))});s(".man_hair li").bind("click",function(){var e=r[r.length-1];ne(e);var t=s(this).index();s(".man_hair li").removeClass("active");s(this).addClass("active");W(e,t);ae(s(this))});s(".woman_hair li").bind("click",function(){var e=r[r.length-1];ne(e);var t=s(this).index();s(".woman_hair li").removeClass("active");s(this).addClass("active");W(e,t);ae(s(this))});s(".room li").bind("click",function(){s(".save").show();var e=s(this).index();s(".room li").removeClass("active");s(this).addClass("active");B(e)});s(".others li").bind("click",function(){s(".save").show();var e=s(this).index();s(".others li").removeClass("active");s(this).addClass("active");j(e);ae(s(this));setTimeout(function(){s(".others li").eq(e).removeClass("active")},300)});s(".flag li").bind("click",function(){s(".save").show();var e=s(this).index();s(".flag li").removeClass("active");s(this).addClass("active");J(e);ae(s(this));setTimeout(function(){s(".flag li").eq(e).removeClass("active")},300)});s(".start").bind("click",function(){s(".welcome_layer").fadeOut(300);s(".world_cup_layer").show()});s(".welcome_layer").bind("click",function(){s(".welcome_layer").fadeOut(300);s(".world_cup_layer").show()});s(".guide").bind("click",function(){s(".guide").fadeOut(300)});s(".save").bind("click",function(){s(".category").hide();new TWEEN.Tween(x.scale).to({x:.933,y:.933},200).onUpdate(function(){x.position.set((1-this.x)/.067*25,(1-this.y)/.067*25)}).start();if(f.children.length){for(var e=0;e<f.children.length;e++){var t=f.children[e];t.chosen=false;t.outline.visible=false;w.addChild(t);f.removeChild(t)}}m.visible=true;setTimeout(function(){var e=new Image;e.src=s("canvas")[0].toDataURL("image/png");s(".result_img").append(e);s(".result_img").show();s(".saved_img").append(e);s(".saved_img").show();setTimeout(function(){s(".saved_guide").fadeIn(300);setTimeout(function(){s(".saved_guide").fadeOut(300)},3e3)},500)},230)});setTimeout(function(){s("#firstPage").addClass("loaded")},200);setTimeout(function(){s("#firstPage").fadeOut(500);s("#welcomePage").fadeIn(500)},2800)}(jQuery);