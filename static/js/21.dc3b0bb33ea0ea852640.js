webpackJsonp([21],{AQZM:function(t,a){},Ga6J:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=e("AAo7"),i=e("0xDb"),o={data:function(){return{userData:Object(i.h)(),guestData:Object(i.f)(),payid:"",alipayHtml:"",payMode:"",checkResult:0,payStatus:"100",checkPayResultTimer:null,refreshTimer:null,payCheckOver:!1,pay_mweb_url:"",loadedPayUrlTag:!1}},created:function(){var t=this.$route.query;this.payid=t.payid,this.payMode=t.payMode,this.checkResult=t.checkresult,this.checkResult?"ali"==this.payMode?t.order_no?(this.checkPayResult(),this.reFreshPayResult()):this.payStatus=-1:"LianYun"==this.payMode?this.checkResultLoop():(this.checkPayResult(),this.reFreshPayResult()):this.prepayByH5()},methods:{postBackGameMsg:function(){window.parent.postMessage({backGameTag:!0},"*")},postLoginTip:function(){window.parent.postMessage({loginTip:!0},"*")},checkResultLoop:function(){var t=this,a=0,e=setInterval(function(){a++,t.checkOrderStatus(function(s){(1==s||a>=200)&&(clearInterval(e),t.payStatus=s)})},1500)},reFreshPayResult:function(){var t=this,a={channel:$GLOBAL_CONST.channel,uid:this.userData?this.userData.user.id:this.guestData.uid,token:this.userData?this.userData.token:this.guestData.token,order_no:this.payid,pay_type:"wallt"==this.payMode?3:"ali"==this.payMode?1:"wx"==this.payMode?2:4,trade_type:3},e=0;this.refreshTimer=setInterval(function(){e++,t.$api.decipherPost(s.a.CHECKRESULT,a,function(a){(e>=25||t.payCheckOver)&&t.refreshTimer&&clearInterval(t.refreshTimer)})},3e3)},checkPayResult:function(){var t=this,a={channel:$GLOBAL_CONST.channel,uid:this.userData?this.userData.user.id:this.guestData.uid,token:this.userData?this.userData.token:this.guestData.token,order_no:this.payid,pay_type:"wallt"==this.payMode?3:"ali"==this.payMode?1:"wx"==this.payMode?2:4,trade_type:3};this.$api.decipherPost(s.a.CHECKRESULT,a,function(a){var e=0;t.checkPayResultTimer=setInterval(function(){e++,t.checkOrderStatus(function(a){(1==a||e>=50)&&(clearInterval(t.checkPayResultTimer),t.payStatus=a,t.payCheckOver=!0)})},1500)})},checkOrderStatus:function(t){var a={channel:$GLOBAL_CONST.channel,uid:this.userData?this.userData.user.id:this.guestData.uid,token:this.userData?this.userData.token:this.guestData.token,order_no:this.payid};this.$api.decipherPost(s.a.FINDPAYORDER,a,function(a){var e=null;0==a.status&&a.decryptData&&(e=a.decryptData.order.tally_status),t&&t(e)})},prepayByH5:function(){var t=this;"ali"==this.payMode&&this.$indicator.open();var a=window.location.origin+"/proxyPay?checkresult=1&payid="+this.payid+"&payMode="+this.payMode;/\/pre/.test(window.location.pathname)&&(a=window.location.origin+"/pre/proxyPay?checkresult=1&payid="+this.payid+"&payMode="+this.payMode);var e={channel:$GLOBAL_CONST.channel,uid:this.userData?this.userData.user.id:this.guestData.uid,token:this.userData?this.userData.token:this.guestData.token,order_no:this.payid,pay_type:"wallt"==this.payMode?3:"ali"==this.payMode?1:"wx"==this.payMode?2:4,order_type:2,openid:this.userData?this.userData.user.openid:"",trade_type:3,show_url:a,redirect_uri:a};"online"!=Object(i.e)()&&"wx"==this.payMode&&(e.ip="182.150.56.177"),this.$api.decipherPost(s.a.PREPAYORDER,e,function(a){0==a.status&&a.decryptData?"wx"==t.payMode&&a.decryptData.await?t.wxPrePayAwait(a.decryptData.await_id,function(a){t.pay_mweb_url=a.mweb_url,t.loadedPayUrlTag=!0,t.$refs.openwx.click(),t.checkPayResult(),t.reFreshPayResult()}):"ali"==t.payMode?(t.$indicator.close(),t.alipayHtml=a.decryptData.html,t.$nextTick(function(){document.getElementById("alipaysubmitbtn")?document.getElementById("alipaysubmitbtn").click():document.getElementById("alipaysubmit").submit()})):t.$toast("未知错误，请稍后重试"):("ali"==t.payMode&&t.$indicator.close(),t.$toast(a.message))},function(){"ali"==t.payMode&&t.$indicator.close()})},openInWx:function(){window.parent.postMessage({mwebUrl:this.pay_mweb_url},"*")},wxPrePayAwait:function(t,a){var e=this,o={channel:$GLOBAL_CONST.channel,await_id:t,uid:this.userData?this.userData.user.id:this.guestData.uid,token:this.userData?this.userData.token:this.guestData.token};"online"!=Object(i.e)()&&"wx"==this.payMode&&(o.ip="182.150.56.177");var n=null,c=0,r=function(){e.$api.decipherPost(s.a.PREPAYORDERAWAIT,o,function(t){c++,t.decryptData&&t.decryptData.prepay_id&&(n&&clearInterval(n),a&&a(t.decryptData)),c>30&&(e.$indicator.close(),e.$toast("未知错误，请稍后重试"),n&&clearInterval(n))},function(){e.$indicator.close(),n&&clearInterval(n)})};r(),n=setInterval(r,1e3)}}},n={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"full"},[t.checkResult?e("div",{staticClass:"full common-layer"},["100"==t.payStatus?e("div",{staticClass:"pay-status-box"},[e("i",{staticClass:"icon icon-loading"}),t._v(" "),e("p",{staticClass:"tip-text mt10"},[t._v("订单查询中，请稍候…")])]):1==t.payStatus?e("div",{staticClass:"pay-status-box"},[e("i",{staticClass:"icon icon-paysuccess"}),t._v(" "),e("p",{staticClass:"tip-text mt10"},[t._v("支付成功")]),t._v(" "),t.guestData?e("p",{staticClass:"login-tip",on:{click:t.postLoginTip}},[t._v("立即登录以保存游戏进度")]):t._e()]):3==t.payStatus?e("div",{staticClass:"pay-status-box"},[e("i",{staticClass:"icon icon-payerror"}),t._v(" "),e("p",{staticClass:"tip-text mt10"},[t._v("支付锁定")])]):e("div",{staticClass:"pay-status-box"},[e("i",{staticClass:"icon icon-payerror"}),t._v(" "),e("p",{staticClass:"tip-text mt10"},[t._v("支付失败")])])]):["ali"==t.payMode?e("div",{attrs:{id:"aliPayBox"},domProps:{innerHTML:t._s(t.alipayHtml)}}):"wx"==t.payMode?e("div",{staticClass:"common-layer"},["100"==t.payStatus?e("div",{staticClass:"pay-status-box"},[e("i",{staticClass:"icon icon-loading"}),t._v(" "),e("p",{staticClass:"tip-text mt10"},[t._v("订单同步中，请稍候…")]),t._v(" "),e("a",{directives:[{name:"show",rawName:"v-show",value:t.loadedPayUrlTag,expression:"loadedPayUrlTag"}],ref:"openwx",staticClass:"common-btn mt40",on:{click:t.openInWx}},[t._v("打开微信支付")])]):1==t.payStatus?e("div",{staticClass:"pay-status-box"},[e("i",{staticClass:"icon icon-paysuccess"}),t._v(" "),e("p",{staticClass:"tip-text mt10"},[t._v("支付成功")]),t._v(" "),t.guestData?e("p",{staticClass:"login-tip",on:{click:t.postLoginTip}},[t._v("立即登录以保存游戏进度")]):t._e()]):3==t.payStatus?e("div",{staticClass:"pay-status-box"},[e("i",{staticClass:"icon icon-payerror"}),t._v(" "),e("p",{staticClass:"tip-text mt10"},[t._v("支付锁定")])]):e("div",{staticClass:"pay-status-box"},[e("i",{staticClass:"icon icon-payerror"}),t._v(" "),e("p",{staticClass:"tip-text mt10"},[t._v("支付失败")])])]):t._e()]],2)},staticRenderFns:[]};var c=e("vSla")(o,n,!1,function(t){e("AQZM")},"data-v-28cf999c",null);a.default=c.exports}});